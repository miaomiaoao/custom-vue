<!DOCTYPE html> <html lang=en><!--
 Page saved with SingleFile 
 url: http://zhufengpeixun.com/strong/html/103.16.rollup.3.html 
 saved date: Mon Aug 15 2022 22:11:36 GMT+0800 (中国标准时间)
--><meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1">
<title>珠峰架构师成长计划</title>
<style>html,body,div,span,h2,h3,h4,p,pre,a,code,ul,li,table,tbody,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline}body{background:#fff}ul{list-style:none}table{vertical-align:middle}th,td{text-align:left;font-weight:normal;vertical-align:middle}a:hover{text-decoration:underline}.markdown-body{padding:30px 35px 30px 35px;word-wrap:break-word;font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.4em;color:#333}@media screen and (max-width:479px){.markdown-body{padding:30px 10px 30px 10px}}.markdown-body>*:first-child{margin-top:0!important}.markdown-body h2,.markdown-body h3,.markdown-body h4{position:relative;margin-top:1em;margin-bottom:16px;font-weight:bold;line-height:1.4}.markdown-body h2{padding-bottom:.3em;font-size:1.75em;line-height:1.225;border-bottom:1px dashed #dedede}.markdown-body p,.markdown-body ul,.markdown-body table,.markdown-body pre{margin-top:0;margin-bottom:16px}.markdown-body ul{padding-left:1.4em;list-style:initial}.markdown-body pre{padding:16px;overflow:auto;background-color:#e5e5e5;border-radius:3px;word-break:break-all;word-wrap:break-word;font:16px Consolas,"Liberation Mono",Menlo,Courier,monospace}.markdown-body pre code{background-color:transparent;color:inherit;line-height:16px;display:block;font-size:14px}.markdown-body pre code:before,.markdown-body pre code:after,.markdown-body pre tt:before,.markdown-body pre tt:after{letter-spacing:0;content:""}.markdown-body code{padding:0;padding-bottom:2px;margin:0 3px;vertical-align:top;background-color:#ededf7;border-radius:4px;padding-left:3px;padding-right:3px;font-size:14px;color:#6f5990}.markdown-body code:before,.markdown-body code:after,.markdown-body tt:before,.markdown-body tt:after{content:" ";vertical-align:text-top}.markdown-body table{width:100%;border-collapse:collapse;border-spacing:0;max-width:100%;display:block;background-color:transparent}.markdown-body table th,.markdown-body table td{border:1px solid #ddd;padding:4px 10px}.markdown-body table th{font-weight:bold;background:#f3f3f3}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body table tbody{background:#fff}.hljs-comment{color:#969896;font-size:90%}.hljs-keyword,.hljs-subst{color:#a71d5d;font-weight:bold}.hljs-number{color:#008080}.hljs-string{color:#183691}.hljs-title{color:#900;font-weight:bold}.hljs-subst{font-weight:normal}.hljs-built_in{color:#0086b3}.hljs-addition{background:#dfd}body,html{height:100%}.logo{float:left;padding:10px 20px 0 0;font-size:24px;color:#61dafb}.nav{background:#20232a;z-index:2;height:80px;line-height:61px;border-bottom:1px solid #c4c4c4;padding:0 0 0 20px;position:fixed;width:100%}@media screen and (max-width:479px){.nav{height:initial;position:initial}}.nav ul{list-style:none;position:relative;display:block;overflow-x:auto;height:100%}@media screen and (max-width:479px){.nav ul{display:-ms-inline-flexbox;display:inline-flex;width:100%;overflow:auto}}.nav ul li{float:left;line-height:40px}.nav ul li a{color:#fff;text-decoration:none;padding:0 15px}.nav ul li:hover a{color:#61dafb}.nav ul li.active a{color:#61dafb;height:40px}.nav ul:after{content:"";clear:both;display:block}.warpper{width:100%;padding:80px 0 0 0;height:100%;overflow:auto}@media screen and (max-width:479px){.warpper{padding-top:0}}.warpper .markdown-body{height:100%}.warpper .markdown-body{margin-left:220px;overflow:auto}@media screen and (max-width:479px){.warpper .markdown-body{margin-left:0}}.warpper .page-toc{height:calc(100% - 80px);position:fixed;width:220px;border-right:1px solid #bbb;box-shadow:0 0 20px #ccc;background:#f7f7f7;padding:10px;overflow-y:auto;overflow-x:hidden;font-family:"Lucida Grande","Lucida Sans Unicode",Helvetica,Arial,sans-serif!important}@media screen and (max-width:479px){.warpper .page-toc{display:none}}.warpper .page-toc ul{list-style-type:none;margin:0}.warpper .page-toc ul a{display:block;padding:3px 0;color:#151515;text-decoration:none;font-weight:700;line-height:16px;font-size:14px}.warpper .page-toc ul a:hover{text-decoration:underline}.warpper .page-toc ul li{padding-left:3px;line-height:25px;text-align:left}.warpper .page-toc ul ul{margin:0 0 0 10px;padding:0 0 0 9px}.warpper .page-toc ul ul li a{font-size:90%;font-weight:normal;border-bottom:0;position:relative}::-webkit-scrollbar-track-piece{background-color:#fff;-webkit-border-radius:0}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-thumb{height:50px;background-color:#999;-webkit-border-radius:4px;outline:2px solid #fff;outline-offset:-2px;border:2px solid #fff}::-webkit-scrollbar-thumb:hover{height:50px;background-color:#9f9f9f;-webkit-border-radius:4px}/*!
 * Bootstrap v3.4.1 (https://getbootstrap.com/)
 * Copyright 2011-2019 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 *//*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}a{background-color:transparent}a:active,a:hover{outline:0}/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}a{color:#337ab7;text-decoration:none}a:focus,a:hover{color:#23527c;text-decoration:underline}a:focus{outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}h2,h3,h4{font-family:inherit;color:inherit}h3{font-size:24px}h4{font-size:18px}p{margin:0 0 10px}ul{margin-top:0;margin-bottom:10px}ul ul{margin-bottom:0}code,pre{font-family:Menlo,Monaco,Consolas,"Courier New",monospace}pre{display:block;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;border:1px solid #ccc}pre code{white-space:pre-wrap}.nav{padding-left:0;margin-bottom:0;list-style:none}@-webkit-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}@-o-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}.modal-open{overflow:hidden}.btn-group-vertical>.btn-group:after,.btn-group-vertical>.btn-group:before,.btn-toolbar:after,.btn-toolbar:before,.clearfix:after,.clearfix:before,.container-fluid:after,.container-fluid:before,.container:after,.container:before,.dl-horizontal dd:after,.dl-horizontal dd:before,.form-horizontal .form-group:after,.form-horizontal .form-group:before,.modal-footer:after,.modal-footer:before,.modal-header:after,.modal-header:before,.nav:after,.nav:before,.navbar-collapse:after,.navbar-collapse:before,.navbar-header:after,.navbar-header:before,.navbar:after,.navbar:before,.pager:after,.pager:before,.panel-body:after,.panel-body:before,.row:after,.row:before{display:table;content:" "}.btn-group-vertical>.btn-group:after,.btn-toolbar:after,.clearfix:after,.container-fluid:after,.container:after,.dl-horizontal dd:after,.form-horizontal .form-group:after,.modal-footer:after,.modal-header:after,.nav:after,.navbar-collapse:after,.navbar-header:after,.navbar:after,.pager:after,.panel-body:after,.row:after{clear:both}@-ms-viewport{width:device-width}.sf-hidden{display:none!important}</style><link rel=canonical href=http://zhufengpeixun.com/strong/html/103.16.rollup.3.html><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body class=modal-open>
<div class=nav>
 <div class=logo>
 
 珠峰架构师成长计划
 
 </div>
 <ul><li><a href=http://zhufengpeixun.com/strong/index.html>0.api</a><li><a href=http://zhufengpeixun.com/strong/html/0.Async.html>0.Async</a><li><a href=http://zhufengpeixun.com/strong/html/0.module.html>0.module</a><li><a href=http://zhufengpeixun.com/strong/html/1.ES2015.html>1.ES2015</a><li><a href=http://zhufengpeixun.com/strong/html/2.Promise.html>2.Promise</a><li><a href=http://zhufengpeixun.com/strong/html/3.Node.html>3.Node</a><li><a href=http://zhufengpeixun.com/strong/html/4.NodeInstall.html>4.NodeInstall</a><li><a href=http://zhufengpeixun.com/strong/html/5.REPL.html>5.REPL</a><li><a href=http://zhufengpeixun.com/strong/html/6.NodeCore.html>6.NodeCore</a><li><a href=http://zhufengpeixun.com/strong/html/7.module&amp;NPM.html>7.module&amp;NPM</a><li><a href=http://zhufengpeixun.com/strong/html/8.Encoding.html>8.Encoding</a><li><a href=http://zhufengpeixun.com/strong/html/9.Buffer.html>9.Buffer</a><li><a href=http://zhufengpeixun.com/strong/html/10.fs.html>10.fs</a><li><a href=http://zhufengpeixun.com/strong/html/11.Stream-1.html>11.Stream-1</a><li><a href=http://zhufengpeixun.com/strong/html/11.Stream-2.html>11.Stream-2</a><li><a href=http://zhufengpeixun.com/strong/html/11.Stream-3.html>11.Stream-3</a><li><a href=http://zhufengpeixun.com/strong/html/11.Stream-4.html>11.Stream-4</a><li><a href=http://zhufengpeixun.com/strong/html/12-Network-2.html>12-Network-2</a><li><a href=http://zhufengpeixun.com/strong/html/12.NetWork-3.html>12.NetWork-3</a><li><a href=http://zhufengpeixun.com/strong/html/12.Network-1.html>12.Network-1</a><li><a href=http://zhufengpeixun.com/strong/html/13.tcp.html>13.tcp</a><li><a href=http://zhufengpeixun.com/strong/html/14.http-1.html>14.http-1</a><li><a href=http://zhufengpeixun.com/strong/html/14.http-2.html>14.http-2</a><li><a href=http://zhufengpeixun.com/strong/html/15.compress.html>15.compress</a><li><a href=http://zhufengpeixun.com/strong/html/16.crypto.html>16.crypto</a><li><a href=http://zhufengpeixun.com/strong/html/17.process.html>17.process</a><li><a href=http://zhufengpeixun.com/strong/html/18.yargs.html>18.yargs</a><li><a href=http://zhufengpeixun.com/strong/html/19.cache.html>19.cache</a><li><a href=http://zhufengpeixun.com/strong/html/20.action.html>20.action</a><li><a href=http://zhufengpeixun.com/strong/html/21.https.html>21.https</a><li><a href=http://zhufengpeixun.com/strong/html/22.cookie.html>22.cookie</a><li><a href=http://zhufengpeixun.com/strong/html/23.session.html>23.session</a><li><a href=http://zhufengpeixun.com/strong/html/24.express-1.html>24.express-1</a><li><a href=http://zhufengpeixun.com/strong/html/24.express-2.html>24.express-2</a><li><a href=http://zhufengpeixun.com/strong/html/24.express-3.html>24.express-3</a><li><a href=http://zhufengpeixun.com/strong/html/24.express-4.html>24.express-4</a><li><a href=http://zhufengpeixun.com/strong/html/25.koa-1.html>25.koa-1</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-1-basic.html>26.webpack-1-basic</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-2-optimize.html>26.webpack-2-optimize</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-3-file.html>26.webpack-3-file</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-4.tapable.html>26.webpack-4.tapable</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-5-AST.html>26.webpack-5-AST</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-6-sources.html>26.webpack-6-sources</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-7-loader.html>26.webpack-7-loader</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-8-plugin.html>26.webpack-8-plugin</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-9-hand.html>26.webpack-9-hand</a><li><a href=http://zhufengpeixun.com/strong/html/26.webpack-10-prepare.html>26.webpack-10-prepare</a><li><a href=http://zhufengpeixun.com/strong/html/28.redux.html>28.redux</a><li><a href=http://zhufengpeixun.com/strong/html/28.redux-jwt-back.html>28.redux-jwt-back</a><li><a href=http://zhufengpeixun.com/strong/html/28.redux-jwt-front.html>28.redux-jwt-front</a><li><a href=http://zhufengpeixun.com/strong/html/29.mongodb-1.html>29.mongodb-1</a><li><a href=http://zhufengpeixun.com/strong/html/29.mongodb-2.html>29.mongodb-2</a><li><a href=http://zhufengpeixun.com/strong/html/29.mongodb-3.html>29.mongodb-3</a><li><a href=http://zhufengpeixun.com/strong/html/29.mongodb-4.html>29.mongodb-4</a><li><a href=http://zhufengpeixun.com/strong/html/29.mongodb-5.html>29.mongodb-5</a><li><a href=http://zhufengpeixun.com/strong/html/29.mongodb-6.html>29.mongodb-6</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-1-mysql.html>30.cms-1-mysql</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-2-mysql.html>30.cms-2-mysql</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-3-mysql.html>30.cms-3-mysql</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-4-nunjucks.html>30.cms-4-nunjucks</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-5-mock.html>30.cms-5-mock</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-6-egg.html>30.cms-6-egg</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-7-api.html>30.cms-7-api</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-8-roadhog.html>30.cms-8-roadhog</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-9-yaml.html>30.cms-9-yaml</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-10-umi.html>30.cms-10-umi</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-12-dva.html>30.cms-12-dva</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-13-dva-ant.html>30.cms-13-dva-ant</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-14-front.html>30.cms-14-front</a><li><a href=http://zhufengpeixun.com/strong/html/30.cms-15-deploy.html>30.cms-15-deploy</a><li><a href=http://zhufengpeixun.com/strong/html/31.dva.html>31.dva</a><li><a href=http://zhufengpeixun.com/strong/html/31.cms-13-dva-antdesign.html>31.cms-13-dva-antdesign</a><li><a href=http://zhufengpeixun.com/strong/html/33.redis.html>33.redis</a><li><a href=http://zhufengpeixun.com/strong/html/34.unittest.html>34.unittest</a><li><a href=http://zhufengpeixun.com/strong/html/35.jwt.html>35.jwt</a><li><a href=http://zhufengpeixun.com/strong/html/36.websocket-1.html>36.websocket-1</a><li><a href=http://zhufengpeixun.com/strong/html/36.websocket-2.html>36.websocket-2</a><li><a href=http://zhufengpeixun.com/strong/html/38.chat-api-1.html>38.chat-api-1</a><li><a href=http://zhufengpeixun.com/strong/html/38.chat-api-2.html>38.chat-api-2</a><li><a href=http://zhufengpeixun.com/strong/html/38.chat-3.html>38.chat-3</a><li><a href=http://zhufengpeixun.com/strong/html/38.chat-api-3.html>38.chat-api-3</a><li><a href=http://zhufengpeixun.com/strong/html/38.chat.html>38.chat</a><li><a href=http://zhufengpeixun.com/strong/html/38.chat2.html>38.chat2</a><li><a href=http://zhufengpeixun.com/strong/html/38.chat2.html>38.chat2</a><li><a href=http://zhufengpeixun.com/strong/html/39.crawl-0.html>39.crawl-0</a><li><a href=http://zhufengpeixun.com/strong/html/39.crawl-1.html>39.crawl-1</a><li><a href=http://zhufengpeixun.com/strong/html/39.crawl-2.html>39.crawl-2</a><li><a href=http://zhufengpeixun.com/strong/html/40.deploy.html>40.deploy</a><li><a href=http://zhufengpeixun.com/strong/html/41.safe.html>41.safe</a><li><a href=http://zhufengpeixun.com/strong/html/42.test.html>42.test</a><li><a href=http://zhufengpeixun.com/strong/html/43.nginx.html>43.nginx</a><li><a href=http://zhufengpeixun.com/strong/html/44.enzyme.html>44.enzyme</a><li><a href=http://zhufengpeixun.com/strong/html/45.docker.html>45.docker</a><li><a href=http://zhufengpeixun.com/strong/html/46.elastic.html>46.elastic</a><li><a href=http://zhufengpeixun.com/strong/html/47.oauth.html>47.oauth</a><li><a href=http://zhufengpeixun.com/strong/html/48.wxpay.html>48.wxpay</a><li><a href=http://zhufengpeixun.com/strong/html/index.html>index</a><li><a href=http://zhufengpeixun.com/strong/html/52.UML.html>52.UML</a><li><a href=http://zhufengpeixun.com/strong/html/53.design.html>53.design</a><li><a href=http://zhufengpeixun.com/strong/html/index.html>index</a><li><a href=http://zhufengpeixun.com/strong/html/54.linux.html>54.linux</a><li><a href=http://zhufengpeixun.com/strong/html/57.ts.html>57.ts</a><li><a href=http://zhufengpeixun.com/strong/html/56.react-ssr.html>56.react-ssr</a><li><a href=http://zhufengpeixun.com/strong/html/58.ts_react.html>58.ts_react</a><li><a href=http://zhufengpeixun.com/strong/html/59.ketang.html>59.ketang</a><li><a href=http://zhufengpeixun.com/strong/html/59.ketang2.html>59.ketang2</a><li><a href=http://zhufengpeixun.com/strong/html/61.1.devops-linux.html>61.1.devops-linux</a><li><a href=http://zhufengpeixun.com/strong/html/61.2.devops-vi.html>61.2.devops-vi</a><li><a href=http://zhufengpeixun.com/strong/html/61.3.devops-user.html>61.3.devops-user</a><li><a href=http://zhufengpeixun.com/strong/html/61.4.devops-auth.html>61.4.devops-auth</a><li><a href=http://zhufengpeixun.com/strong/html/61.5.devops-shell.html>61.5.devops-shell</a><li><a href=http://zhufengpeixun.com/strong/html/61.6.devops-install.html>61.6.devops-install</a><li><a href=http://zhufengpeixun.com/strong/html/61.7.devops-system.html>61.7.devops-system</a><li><a href=http://zhufengpeixun.com/strong/html/61.8.devops-service.html>61.8.devops-service</a><li><a href=http://zhufengpeixun.com/strong/html/61.9.devops-network.html>61.9.devops-network</a><li><a href=http://zhufengpeixun.com/strong/html/61.10.devops-nginx.html>61.10.devops-nginx</a><li><a href=http://zhufengpeixun.com/strong/html/61.11.devops-docker.html>61.11.devops-docker</a><li><a href=http://zhufengpeixun.com/strong/html/61.12.devops-jekins.html>61.12.devops-jekins</a><li><a href=http://zhufengpeixun.com/strong/html/61.13.devops-groovy.html>61.13.devops-groovy</a><li><a href=http://zhufengpeixun.com/strong/html/61.14.devops-php.html>61.14.devops-php</a><li><a href=http://zhufengpeixun.com/strong/html/61.15.devops-java.html>61.15.devops-java</a><li><a href=http://zhufengpeixun.com/strong/html/61.16.devops-node.html>61.16.devops-node</a><li><a href=http://zhufengpeixun.com/strong/html/61.17.devops-k8s.html>61.17.devops-k8s</a><li><a href=http://zhufengpeixun.com/strong/html/62.1.react-basic.html>62.1.react-basic</a><li><a href=http://zhufengpeixun.com/strong/html/62.2.react-state.html>62.2.react-state</a><li><a href=http://zhufengpeixun.com/strong/html/62.3.react-high.html>62.3.react-high</a><li><a href=http://zhufengpeixun.com/strong/html/62.4.react-optimize.html>62.4.react-optimize</a><li><a href=http://zhufengpeixun.com/strong/html/62.5.react-hooks.html>62.5.react-hooks</a><li><a href=http://zhufengpeixun.com/strong/html/62.6.react-immutable.html>62.6.react-immutable</a><li><a href=http://zhufengpeixun.com/strong/html/62.7.react-mobx.html>62.7.react-mobx</a><li><a href=http://zhufengpeixun.com/strong/html/62.8.react-source.html>62.8.react-source</a><li><a href=http://zhufengpeixun.com/strong/html/63.1.redux.html>63.1.redux</a><li><a href=http://zhufengpeixun.com/strong/html/63.2.redux-middleware.html>63.2.redux-middleware</a><li><a href=http://zhufengpeixun.com/strong/html/63.3.redux-hooks.html>63.3.redux-hooks</a><li><a href=http://zhufengpeixun.com/strong/html/63.4.redux-saga.html>63.4.redux-saga</a><li><a href=http://zhufengpeixun.com/strong/html/63.5.redux-saga-hand.html>63.5.redux-saga-hand</a><li><a href=http://zhufengpeixun.com/strong/html/64.1.router.html>64.1.router</a><li><a href=http://zhufengpeixun.com/strong/html/64.2.router-connected.html>64.2.router-connected</a><li><a href=http://zhufengpeixun.com/strong/html/65.1.typescript.html>65.1.typescript</a><li><a href=http://zhufengpeixun.com/strong/html/65.2.typescript.html>65.2.typescript</a><li><a href=http://zhufengpeixun.com/strong/html/65.3.typescript.html>65.3.typescript</a><li><a href=http://zhufengpeixun.com/strong/html/65.4.antd.html>65.4.antd</a><li><a href=http://zhufengpeixun.com/strong/html/65.4.definition.html>65.4.definition</a><li><a href=http://zhufengpeixun.com/strong/html/66-1.vue-base.html>66-1.vue-base</a><li><a href=http://zhufengpeixun.com/strong/html/66-2.vue-component.html>66-2.vue-component</a><li><a href=http://zhufengpeixun.com/strong/html/66-3.vue-cli3.0.html>66-3.vue-cli3.0</a><li><a href=http://zhufengpeixun.com/strong/html/66-4.$message%E7%BB%84%E4%BB%B6.html>66-4.$message组件</a><li><a href=http://zhufengpeixun.com/strong/html/66-5.Form%E7%BB%84%E4%BB%B6.html>66-5.Form组件</a><li><a href=http://zhufengpeixun.com/strong/html/66-6.tree.html>66-6.tree</a><li><a href=http://zhufengpeixun.com/strong/html/66-7.vue-router-apply.html>66-7.vue-router-apply</a><li><a href=http://zhufengpeixun.com/strong/html/66-8.axios-apply.html>66-8.axios-apply</a><li><a href=http://zhufengpeixun.com/strong/html/66-9.vuex-apply.html>66-9.vuex-apply</a><li><a href=http://zhufengpeixun.com/strong/html/66-10.jwt-vue.html>66-10.jwt-vue</a><li><a href=http://zhufengpeixun.com/strong/html/66-11.vue-ssr.html>66-11.vue-ssr</a><li><a href=http://zhufengpeixun.com/strong/html/66-12.nuxt-apply.html>66-12.nuxt-apply</a><li><a href=http://zhufengpeixun.com/strong/html/66-13.pwa.html>66-13.pwa</a><li><a href=http://zhufengpeixun.com/strong/html/66-14.vue%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.html>66-14.vue单元测试</a><li><a href=http://zhufengpeixun.com/strong/html/66-15.%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C.html>66-15.权限校验</a><li><a href=http://zhufengpeixun.com/strong/html/67-1-network.html>67-1-network</a><li><a href=http://zhufengpeixun.com/strong/html/68-2-wireshark.html>68-2-wireshark</a><li><a href=http://zhufengpeixun.com/strong/html/7.npm2.html>7.npm2</a><li><a href=http://zhufengpeixun.com/strong/html/69-hooks.html>69-hooks</a><li><a href=http://zhufengpeixun.com/strong/html/70-deploy.html>70-deploy</a><li><a href=http://zhufengpeixun.com/strong/html/71-hmr.html>71-hmr</a><li><a href=http://zhufengpeixun.com/strong/html/72.deploy.html>72.deploy</a><li><a href=http://zhufengpeixun.com/strong/html/73.import.html>73.import</a><li><a href=http://zhufengpeixun.com/strong/html/74.mobile.html>74.mobile</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-1.%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90.html>75.webpack-1.文件分析</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-2.loader.html>75.webpack-2.loader</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-3.%E6%BA%90%E7%A0%81%E6%B5%81%E7%A8%8B.html>75.webpack-3.源码流程</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-4.tapable.html>75.webpack-4.tapable</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-5.prepare.html>75.webpack-5.prepare</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-6.resolve.html>75.webpack-6.resolve</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-7.loader.html>75.webpack-7.loader</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-8.module.html>75.webpack-8.module</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-9.chunk.html>75.webpack-9.chunk</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-10.asset.html>75.webpack-10.asset</a><li><a href=http://zhufengpeixun.com/strong/html/75.webpack-11.%E5%AE%9E%E7%8E%B0.html>75.webpack-11.实现</a><li><a href=http://zhufengpeixun.com/strong/html/76.react_optimize.html>76.react_optimize</a><li><a href=http://zhufengpeixun.com/strong/html/77.ts_ketang_back.html>77.ts_ketang_back</a><li><a href=http://zhufengpeixun.com/strong/html/77.ts_ketang_front.html>77.ts_ketang_front</a><li><a href=http://zhufengpeixun.com/strong/html/78.vue-domdiff.html>78.vue-domdiff</a><li><a href=http://zhufengpeixun.com/strong/html/79.grammar.html>79.grammar</a><li><a href=http://zhufengpeixun.com/strong/html/80.tree.html>80.tree</a><li><a href=http://zhufengpeixun.com/strong/html/81.axios.html>81.axios</a><li><a href=http://zhufengpeixun.com/strong/html/82.1.react.html>82.1.react</a><li><a href=http://zhufengpeixun.com/strong/html/82.2.react-high.html>82.2.react-high</a><li><a href=http://zhufengpeixun.com/strong/html/82.3.react-router.html>82.3.react-router</a><li><a href=http://zhufengpeixun.com/strong/html/82.4.redux.html>82.4.redux</a><li><a href=http://zhufengpeixun.com/strong/html/82.5.redux_middleware.html>82.5.redux_middleware</a><li><a href=http://zhufengpeixun.com/strong/html/82.6.connected.html>82.6.connected</a><li><a href=http://zhufengpeixun.com/strong/html/82.7.saga.html>82.7.saga</a><li><a href=http://zhufengpeixun.com/strong/html/82.8.dva.html>82.8.dva</a><li><a href=http://zhufengpeixun.com/strong/html/82.8.dva-source.html>82.8.dva-source</a><li><a href=http://zhufengpeixun.com/strong/html/82.9.roadhog.html>82.9.roadhog</a><li><a href=http://zhufengpeixun.com/strong/html/82.10.umi.html>82.10.umi</a><li><a href=http://zhufengpeixun.com/strong/html/82.11.antdesign.html>82.11.antdesign</a><li><a href=http://zhufengpeixun.com/strong/html/82.12.ketang-front.html>82.12.ketang-front</a><li><a href=http://zhufengpeixun.com/strong/html/82.12.ketang-back.html>82.12.ketang-back</a><li><a href=http://zhufengpeixun.com/strong/html/83.upload.html>83.upload</a><li><a href=http://zhufengpeixun.com/strong/html/84.graphql.html>84.graphql</a><li><a href=http://zhufengpeixun.com/strong/html/85.antpro.html>85.antpro</a><li><a href=http://zhufengpeixun.com/strong/html/86.1.uml.html>86.1.uml</a><li><a href=http://zhufengpeixun.com/strong/html/86.2.design.html>86.2.design</a><li><a href=http://zhufengpeixun.com/strong/html/87.postcss.html>87.postcss</a><li><a href=http://zhufengpeixun.com/strong/html/88.react16-1.html>88.react16-1</a><li><a href=http://zhufengpeixun.com/strong/html/89.nextjs.html>89.nextjs</a><li><a href=http://zhufengpeixun.com/strong/html/90.react-test.html>90.react-test</a><li><a href=http://zhufengpeixun.com/strong/html/91.react-ts.html>91.react-ts</a><li><a href=http://zhufengpeixun.com/strong/html/92.rbac.html>92.rbac</a><li><a href=http://zhufengpeixun.com/strong/html/93.tsnode.html>93.tsnode</a><li><a href=http://zhufengpeixun.com/strong/html/94.1.JavaScript.html>94.1.JavaScript</a><li><a href=http://zhufengpeixun.com/strong/html/94.2.JavaScript.html>94.2.JavaScript</a><li><a href=http://zhufengpeixun.com/strong/html/94.3.MODULE.html>94.3.MODULE</a><li><a href=http://zhufengpeixun.com/strong/html/94.4.EventLoop.html>94.4.EventLoop</a><li><a href=http://zhufengpeixun.com/strong/html/94.5.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.html>94.5.文件上传</a><li><a href=http://zhufengpeixun.com/strong/html/94.6.https.html>94.6.https</a><li><a href=http://zhufengpeixun.com/strong/html/94.7.%20nginx.html>94.7. nginx</a><li><a href=http://zhufengpeixun.com/strong/html/95.1.%20react.html>95.1. react</a><li><a href=http://zhufengpeixun.com/strong/html/95.2.react.html>95.2.react</a><li><a href=http://zhufengpeixun.com/strong/html/96.1.react16.html>96.1.react16</a><li><a href=http://zhufengpeixun.com/strong/html/96.2.fiber.html>96.2.fiber</a><li><a href=http://zhufengpeixun.com/strong/html/96.3.fiber.html>96.3.fiber</a><li><a href=http://zhufengpeixun.com/strong/html/97.serverless.html>97.serverless</a><li><a href=http://zhufengpeixun.com/strong/html/98.websocket.html>98.websocket</a><li><a href=http://zhufengpeixun.com/strong/html/100.1.react-basic.html>100.1.react-basic</a><li><a href=http://zhufengpeixun.com/strong/html/101.1.monitor.html>101.1.monitor</a><li><a href=http://zhufengpeixun.com/strong/html/101.2.monitor.html>101.2.monitor</a><li><a href=http://zhufengpeixun.com/strong/html/102.java.html>102.java</a><li><a href=http://zhufengpeixun.com/strong/html/103.1.webpack-usage.html>103.1.webpack-usage</a><li><a href=http://zhufengpeixun.com/strong/html/103.2.webpack-bundle.html>103.2.webpack-bundle</a><li><a href=http://zhufengpeixun.com/strong/html/103.3.webpack-ast.html>103.3.webpack-ast</a><li><a href=http://zhufengpeixun.com/strong/html/103.4.webpack-flow.html>103.4.webpack-flow</a><li><a href=http://zhufengpeixun.com/strong/html/103.5.webpack-loader.html>103.5.webpack-loader</a><li><a href=http://zhufengpeixun.com/strong/html/103.6.webpack-tapable.html>103.6.webpack-tapable</a><li><a href=http://zhufengpeixun.com/strong/html/103.7.webpack-plugin.html>103.7.webpack-plugin</a><li><a href=http://zhufengpeixun.com/strong/html/103.8.webpack-optimize1.html>103.8.webpack-optimize1</a><li><a href=http://zhufengpeixun.com/strong/html/103.9.webpack-optimize2.html>103.9.webpack-optimize2</a><li><a href=http://zhufengpeixun.com/strong/html/103.10.webpack-hand.html>103.10.webpack-hand</a><li><a href=http://zhufengpeixun.com/strong/html/103.11.webpack-hmr.html>103.11.webpack-hmr</a><li><a href=http://zhufengpeixun.com/strong/html/103.11.webpack5.html>103.11.webpack5</a><li><a href=http://zhufengpeixun.com/strong/html/103.13.splitChunks.html>103.13.splitChunks</a><li><a href=http://zhufengpeixun.com/strong/html/103.14.webpack-sourcemap.html>103.14.webpack-sourcemap</a><li><a href=http://zhufengpeixun.com/strong/html/103.15.webpack-compiler1.html>103.15.webpack-compiler1</a><li><a href=http://zhufengpeixun.com/strong/html/103.15.webpack-compiler2.html>103.15.webpack-compiler2</a><li><a href=http://zhufengpeixun.com/strong/html/103.16.rollup.1.html>103.16.rollup.1</a><li><a href=http://zhufengpeixun.com/strong/html/103.16.rollup.2.html>103.16.rollup.2</a><li class=active><a href=http://zhufengpeixun.com/strong/html/103.16.rollup.3.html>103.16.rollup.3</a><li><a href=http://zhufengpeixun.com/strong/html/103.16.vite.basic.html>103.16.vite.basic</a><li><a href=http://zhufengpeixun.com/strong/html/103.16.vite.source.html>103.16.vite.source</a><li><a href=http://zhufengpeixun.com/strong/html/103.16.vite.plugin.html>103.16.vite.plugin</a><li><a href=http://zhufengpeixun.com/strong/html/103.16.vite.1.html>103.16.vite.1</a><li><a href=http://zhufengpeixun.com/strong/html/103.16.vite.2.html>103.16.vite.2</a><li><a href=http://zhufengpeixun.com/strong/html/103.17.polyfill.html>103.17.polyfill</a><li><a href=http://zhufengpeixun.com/strong/html/104.1.binary.html>104.1.binary</a><li><a href=http://zhufengpeixun.com/strong/html/104.2.binary.html>104.2.binary</a><li><a href=http://zhufengpeixun.com/strong/html/105.skeleton.html>105.skeleton</a><li><a href=http://zhufengpeixun.com/strong/html/106.1.react.html>106.1.react</a><li><a href=http://zhufengpeixun.com/strong/html/106.2.react_hooks.html>106.2.react_hooks</a><li><a href=http://zhufengpeixun.com/strong/html/106.3.react_router.html>106.3.react_router</a><li><a href=http://zhufengpeixun.com/strong/html/106.4.redux.html>106.4.redux</a><li><a href=http://zhufengpeixun.com/strong/html/106.5.redux_middleware.html>106.5.redux_middleware</a><li><a href=http://zhufengpeixun.com/strong/html/106.6.connected-react-router.html>106.6.connected-react-router</a><li><a href=http://zhufengpeixun.com/strong/html/106.6.redux-first-history.html>106.6.redux-first-history</a><li><a href=http://zhufengpeixun.com/strong/html/106.7.redux-saga.html>106.7.redux-saga</a><li><a href=http://zhufengpeixun.com/strong/html/106.8.dva.html>106.8.dva</a><li><a href=http://zhufengpeixun.com/strong/html/106.9.umi.html>106.9.umi</a><li><a href=http://zhufengpeixun.com/strong/html/106.10.ketang.html>106.10.ketang</a><li><a href=http://zhufengpeixun.com/strong/html/106.11.antdesign.html>106.11.antdesign</a><li><a href=http://zhufengpeixun.com/strong/html/106.12.antpro.html>106.12.antpro</a><li><a href=http://zhufengpeixun.com/strong/html/106.13.router-6.html>106.13.router-6</a><li><a href=http://zhufengpeixun.com/strong/html/106.14.ssr.html>106.14.ssr</a><li><a href=http://zhufengpeixun.com/strong/html/106.15.nextjs.html>106.15.nextjs</a><li><a href=http://zhufengpeixun.com/strong/html/106.16.1.cms.html>106.16.1.cms</a><li><a href=http://zhufengpeixun.com/strong/html/106.16.2.cms.html>106.16.2.cms</a><li><a href=http://zhufengpeixun.com/strong/html/106.16.3.cms.html>106.16.3.cms</a><li><a href=http://zhufengpeixun.com/strong/html/106.16.4.cms.html>106.16.4.cms</a><li><a href=http://zhufengpeixun.com/strong/html/106.16.mobx.html>106.16.mobx</a><li><a href=http://zhufengpeixun.com/strong/html/106.17.fomily.html>106.17.fomily</a><li><a href=http://zhufengpeixun.com/strong/html/107.fiber.html>107.fiber</a><li><a href=http://zhufengpeixun.com/strong/html/108.http.html>108.http</a><li><a href=http://zhufengpeixun.com/strong/html/109.1.webpack_usage.html>109.1.webpack_usage</a><li><a href=http://zhufengpeixun.com/strong/html/109.2.webpack_source.html>109.2.webpack_source</a><li><a href=http://zhufengpeixun.com/strong/html/109.3.dll.html>109.3.dll</a><li><a href=http://zhufengpeixun.com/strong/html/110.nest.js.html>110.nest.js</a><li><a href=http://zhufengpeixun.com/strong/html/111.xstate.html>111.xstate</a><li><a href=http://zhufengpeixun.com/strong/html/112.Form.html>112.Form</a><li><a href=http://zhufengpeixun.com/strong/html/113.redux-saga.html>113.redux-saga</a><li><a href=http://zhufengpeixun.com/strong/html/114.react+typescript.html>114.react+typescript</a><li><a href=http://zhufengpeixun.com/strong/html/115.immer.html>115.immer</a><li><a href=http://zhufengpeixun.com/strong/html/116.pro5.html>116.pro5</a><li><a href=http://zhufengpeixun.com/strong/html/117.css-loader.html>117.css-loader</a><li><a href=http://zhufengpeixun.com/strong/html/118.1.umi-core.html>118.1.umi-core</a><li><a href=http://zhufengpeixun.com/strong/html/119.2.module-federation.html>119.2.module-federation</a><li><a href=http://zhufengpeixun.com/strong/html/119.1.module-federation.html>119.1.module-federation</a><li><a href=http://zhufengpeixun.com/strong/html/120.create-react-app.html>120.create-react-app</a><li><a href=http://zhufengpeixun.com/strong/html/121.react-scripts.html>121.react-scripts</a><li><a href=http://zhufengpeixun.com/strong/html/122.react-optimize.html>122.react-optimize</a><li><a href=http://zhufengpeixun.com/strong/html/123.jsx-runtime.html>123.jsx-runtime</a><li><a href=http://zhufengpeixun.com/strong/html/124.next.js.html>124.next.js</a><li><a href=http://zhufengpeixun.com/strong/html/125.1.linux.html>125.1.linux</a><li><a href=http://zhufengpeixun.com/strong/html/125.2.linux-vi.html>125.2.linux-vi</a><li><a href=http://zhufengpeixun.com/strong/html/125.3.linux-user.html>125.3.linux-user</a><li><a href=http://zhufengpeixun.com/strong/html/125.4.linux-auth.html>125.4.linux-auth</a><li><a href=http://zhufengpeixun.com/strong/html/125.5.linux-shell.html>125.5.linux-shell</a><li><a href=http://zhufengpeixun.com/strong/html/125.6.linux-install.html>125.6.linux-install</a><li><a href=http://zhufengpeixun.com/strong/html/125.7.linux-system.html>125.7.linux-system</a><li><a href=http://zhufengpeixun.com/strong/html/125.8.linux-service.html>125.8.linux-service</a><li><a href=http://zhufengpeixun.com/strong/html/125.9.linux-network.html>125.9.linux-network</a><li><a href=http://zhufengpeixun.com/strong/html/125.10.nginx.html>125.10.nginx</a><li><a href=http://zhufengpeixun.com/strong/html/125.11.docker.html>125.11.docker</a><li><a href=http://zhufengpeixun.com/strong/html/125.12.ci.html>125.12.ci</a><li><a href=http://zhufengpeixun.com/strong/html/125.13.k8s.html>125.13.k8s</a><li><a href=http://zhufengpeixun.com/strong/html/125.14.k8s.html>125.14.k8s</a><li><a href=http://zhufengpeixun.com/strong/html/125.15.k8s.html>125.15.k8s</a><li><a href=http://zhufengpeixun.com/strong/html/125.16.k8s.html>125.16.k8s</a><li><a href=http://zhufengpeixun.com/strong/html/126.11.react-1.html>126.11.react-1</a><li><a href=http://zhufengpeixun.com/strong/html/126.12.react-2.html>126.12.react-2</a><li><a href=http://zhufengpeixun.com/strong/html/126.12.react-3.html>126.12.react-3</a><li><a href=http://zhufengpeixun.com/strong/html/126.12.react-4.html>126.12.react-4</a><li><a href=http://zhufengpeixun.com/strong/html/126.12.react-5.html>126.12.react-5</a><li><a href=http://zhufengpeixun.com/strong/html/126.12.react-6.html>126.12.react-6</a><li><a href=http://zhufengpeixun.com/strong/html/126.12.react-7.html>126.12.react-7</a><li><a href=http://zhufengpeixun.com/strong/html/126.12.react-8.html>126.12.react-8</a><li><a href=http://zhufengpeixun.com/strong/html/127.frontend.html>127.frontend</a><li><a href=http://zhufengpeixun.com/strong/html/128.rollup.html>128.rollup</a><li><a href=http://zhufengpeixun.com/strong/html/129.px2rem-loader.html>129.px2rem-loader</a><li><a href=http://zhufengpeixun.com/strong/html/130.health.html>130.health</a><li><a href=http://zhufengpeixun.com/strong/html/131.hooks.html>131.hooks</a><li><a href=http://zhufengpeixun.com/strong/html/132.keepalive.html>132.keepalive</a><li><a href=http://zhufengpeixun.com/strong/html/133.vue-cli.html>133.vue-cli</a><li><a href=http://zhufengpeixun.com/strong/html/134.react18.html>134.react18</a><li><a href=http://zhufengpeixun.com/strong/html/134.2.react18.html>134.2.react18</a><li><a href=http://zhufengpeixun.com/strong/html/134.3.react18.html>134.3.react18</a><li><a href=http://zhufengpeixun.com/strong/html/135.function.html>135.function</a><li><a href=http://zhufengpeixun.com/strong/html/136.toolkit.html>136.toolkit</a><li><a href=http://zhufengpeixun.com/strong/html/137.lerna.html>137.lerna</a><li><a href=http://zhufengpeixun.com/strong/html/138.create-vite.html>138.create-vite</a><li><a href=http://zhufengpeixun.com/strong/html/139.cli.html>139.cli</a><li><a href=http://zhufengpeixun.com/strong/html/140.antd.html>140.antd</a><li><a href=http://zhufengpeixun.com/strong/html/141.react-dnd.html>141.react-dnd</a><li><a href=http://zhufengpeixun.com/strong/html/142.1.link.html>142.1.link</a><li><a href=http://zhufengpeixun.com/strong/html/143.1.gulp.html>143.1.gulp</a><li><a href=http://zhufengpeixun.com/strong/html/143.2.stream.html>143.2.stream</a><li><a href=http://zhufengpeixun.com/strong/html/143.3.gulp.html>143.3.gulp</a><li><a href=http://zhufengpeixun.com/strong/html/144.1.closure.html>144.1.closure</a><li><a href=http://zhufengpeixun.com/strong/html/144.2.v8.html>144.2.v8</a><li><a href=http://zhufengpeixun.com/strong/html/144.3.gc.html>144.3.gc</a><li><a href=http://zhufengpeixun.com/strong/html/145.react-router-v6.html>145.react-router-v6</a><li><a href=http://zhufengpeixun.com/strong/html/146.browser.html>146.browser</a><li><a href=http://zhufengpeixun.com/strong/html/147.lighthouse.html>147.lighthouse</a><li><a href=http://zhufengpeixun.com/strong/html/148.1.basic.html>148.1.basic</a><li><a href=http://zhufengpeixun.com/strong/html/148.2.basic%20.html>148.2.basic </a><li><a href=http://zhufengpeixun.com/strong/html/148.3.basic.html>148.3.basic</a><li><a href=http://zhufengpeixun.com/strong/html/148.4.basic.html>148.4.basic</a><li><a href=http://zhufengpeixun.com/strong/html/148.5.basic.html>148.5.basic</a><li><a href=http://zhufengpeixun.com/strong/html/149.1.vite.html>149.1.vite</a><li><a href=http://zhufengpeixun.com/strong/html/149.2.vite.html>149.2.vite</a><li><a href=http://zhufengpeixun.com/strong/html/149.3.vite.html>149.3.vite</a><li><a href=http://zhufengpeixun.com/strong/html/149.4.vite.html>149.4.vite</a><li><a href=http://zhufengpeixun.com/strong/html/150.react-window.html>150.react-window</a><li><a href=http://zhufengpeixun.com/strong/html/151.react-query.html>151.react-query</a><li><a href=http://zhufengpeixun.com/strong/html/152.useRequest.html>152.useRequest</a><li><a href=http://zhufengpeixun.com/strong/html/153.transition.html>153.transition</a><li><a href=http://zhufengpeixun.com/strong/html/154.emotion.html>154.emotion</a><li><a href=http://zhufengpeixun.com/strong/html/155.1.formily.html>155.1.formily</a><li><a href=http://zhufengpeixun.com/strong/html/155.2.formily.html>155.2.formily</a><li><a href=http://zhufengpeixun.com/strong/html/155.3.formily.html>155.3.formily</a><li><a href=http://zhufengpeixun.com/strong/html/155.3.1.mobx.usage.html>155.3.1.mobx.usage</a><li><a href=http://zhufengpeixun.com/strong/html/155.3.2.mobx.source.html>155.3.2.mobx.source</a></ul> </div>
 
<div class=warpper>
 <div class=page-toc>
 <ul><li><a href=#t01.%20rollup>1. rollup</a><ul><li><a href=#t11.1%20debugger.js>1.1 debugger.js</a><li><a href=#t21.2%20rollup.config.js>1.2 rollup.config.js</a><li><a href=#t31.3%20package.json>1.3 package.json</a></ul><li><a href=#t42.%20rollup%E6%8F%92%E4%BB%B6>2. rollup插件</a><ul><li><a href=#t52.1%20%E6%8F%92%E4%BB%B6%E8%A7%84%E8%8C%83>2.1 插件规范</a><li><a href=#t62.2.%E6%8F%92%E4%BB%B6%E5%B1%9E%E6%80%A7>2.2.插件属性</a><ul><li><a href=#t72.2.1%20name>2.2.1 name</a></ul><li><a href=#t82.2%20Build%20Hooks>2.2 Build Hooks</a><ul><li><a href=#t92.2.1%20rollup-plugin-build.js>2.2.1 rollup-plugin-build.js</a><li><a href=#t102.2.2%20rollup.config.js>2.2.2 rollup.config.js</a><li><a href=#t112.2.3%20options>2.2.3 options</a><li><a href=#t122.2.4%20buildStart>2.2.4 buildStart</a><li><a href=#t132.2.5%20resolveId>2.2.5 resolveId</a><li><a href=#t142.2.6%20load>2.2.6 load</a><li><a href=#t152.2.7%20transform>2.2.7 transform</a><li><a href=#t162.2.8%20shouldTransformCachedModule>2.2.8 shouldTransformCachedModule</a><li><a href=#t172.2.9%20moduleParsed>2.2.9 moduleParsed</a><li><a href=#t182.2.10%20resolveDynamicImport>2.2.10 resolveDynamicImport</a><li><a href=#t192.2.11%20buildEnd>2.2.11 buildEnd</a></ul><li><a href=#t202.3%20Output%20Generation%20Hooks>2.3 Output Generation Hooks</a><ul><li><a href=#t212.3.1%20rollup-plugin-generation.js>2.3.1 rollup-plugin-generation.js</a><li><a href=#t222.3.2%20rollup.config.js>2.3.2 rollup.config.js</a><li><a href=#t232.3.3%20outputOptions>2.3.3 outputOptions</a><li><a href=#t242.3.4%20renderStart>2.3.4 renderStart</a><li><a href=#t252.3.5%20banner>2.3.5 banner</a><li><a href=#t262.3.6%20footer>2.3.6 footer</a><li><a href=#t272.3.7%20intro>2.3.7 intro</a><li><a href=#t282.3.8%20outro>2.3.8 outro</a><li><a href=#t292.3.9%20renderDynamicImport>2.3.9 renderDynamicImport</a><li><a href=#t302.3.9%20augmentChunkHash>2.3.9 augmentChunkHash</a><li><a href=#t312.3.10%20resolveFileUrl>2.3.10 resolveFileUrl</a><li><a href=#t322.3.11%20resolveImportMeta>2.3.11 resolveImportMeta</a><li><a href=#t332.3.12%20renderChunk>2.3.12 renderChunk</a><li><a href=#t342.3.13%20generateBundle>2.3.13 generateBundle</a><li><a href=#t352.3.14%20writeBundle>2.3.14 writeBundle</a><li><a href=#t362.3.15%20renderError>2.3.15 renderError</a><li><a href=#t372.3.16%20closeBundle>2.3.16 closeBundle</a></ul></ul><li><a href=#t383.Plugin%20Context>3.Plugin Context</a><ul><li><a href=#t393.1%20this.emitFile>3.1 this.emitFile</a><li><a href=#t403.2%20this.load>3.2 this.load</a><li><a href=#t413.3%20this.load>3.3 this.load</a><li><a href=#t423.4%20this.resolve>3.4 this.resolve</a></ul><li><a href=#t434.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B>4.实战案例</a><ul><li><a href=#t444.1%20@rollup/plugin-babel>4.1 @rollup/plugin-babel</a><ul><li><a href=#t454.1.1%20%E5%AE%89%E8%A3%85>4.1.1 安装</a><li><a href=#t464.1.2%20rollup-plugin-babel.js>4.1.2 rollup-plugin-babel.js</a><li><a href=#t474.1.3%20rollup.config.js>4.1.3 rollup.config.js</a></ul><li><a href=#t484.2%20@rollup/plugin-commonjs>4.2 @rollup/plugin-commonjs</a><ul><li><a href=#t493.2.1%20%E5%AE%89%E8%A3%85>3.2.1 安装</a><li><a href=#t504.2.2%20src\index.js>4.2.2 src\index.js</a><li><a href=#t514.2.3%20src\cat.js>4.2.3 src\cat.js</a><li><a href=#t524.2.4%20rollup-plugin-commonjs.js>4.2.4 rollup-plugin-commonjs.js</a><li><a href=#t534.2.5%20rollup.config.js>4.2.5 rollup.config.js</a></ul><li><a href=#t544.3%20@rollup/plugin-node-resolve>4.3 @rollup/plugin-node-resolve</a><ul><li><a href=#t554.3.1%20%E5%AE%89%E8%A3%85>4.3.1 安装</a><li><a href=#t564.3.2%20src\index.js>4.3.2 src\index.js</a><li><a href=#t574.3.3%20rollup-plugin-node-resolve.js>4.3.3 rollup-plugin-node-resolve.js</a></ul><li><a href=#t584.4%20@rollup/plugin-alias>4.4 @rollup/plugin-alias</a><ul><li><a href=#t594.4.1%20rollup.config.js>4.4.1 rollup.config.js</a><li><a href=#t604.4.2%20rollup-plugin-alias.js>4.4.2 rollup-plugin-alias.js</a></ul></ul></ul>
 </div>
 <div class="content markdown-body">
 <h2 id="t01. rollup">1. rollup <a href=#t01.%20rollup class=sf-hidden> # </a></h2>
<ul>
<li><code>Rollup</code>是一个<code>JavaScript</code>模块打包器，可以将小块代码编译成大块复杂的代码，例如<code>library</code>或应用程序</li>
</ul>
<h3 id="t11.1 debugger.js">1.1 debugger.js <a href=#t11.1%20debugger.js class=sf-hidden> # </a></h3>
<pre><code class=lang-js><span class=hljs-keyword>import</span> { rollup, watch } <span class=hljs-keyword>from</span> <span class=hljs-string>'rollup'</span>;
<span class=hljs-keyword>import</span> inputOptions <span class=hljs-keyword>from</span> <span class=hljs-string>'./rollup.config.js'</span>
  ; (<span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params></span>) </span>{
    <span class=hljs-comment>//打包阶段 </span>
    <span class=hljs-keyword>const</span> bundle = <span class=hljs-keyword>await</span> rollup(inputOptions);
    <span class=hljs-comment>//生成阶段</span>
    <span class=hljs-keyword>await</span> bundle.generate(inputOptions.output);
    <span class=hljs-comment>//写入阶段</span>
    <span class=hljs-keyword>await</span> bundle.write(inputOptions.output);
    <span class=hljs-comment>/* 
    const watcher = watch(inputOptions);
    watcher.on('event', event =&gt; {
      console.log(event);
    });
    setTimeout(() =&gt; {
      watcher.close();
    }, 1000); */</span>
    <span class=hljs-comment>//关闭阶段</span>
    <span class=hljs-keyword>await</span> bundle.close();
  })();
</code></pre>
<h3 id="t21.2 rollup.config.js">1.2 rollup.config.js <a href=#t21.2%20rollup.config.js class=sf-hidden> # </a></h3>
<p>rollup.config.js</p>
<pre><code class=lang-js><span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> {
  <span class=hljs-attr>input</span>: <span class=hljs-string>"./src/index.js"</span>,
  <span class=hljs-attr>output</span>: {
    <span class=hljs-attr>dir</span>: <span class=hljs-string>'dist'</span>,
  }
}
</code></pre>
<h3 id="t31.3 package.json">1.3 package.json <a href=#t31.3%20package.json class=sf-hidden> # </a></h3>
<p>package.json</p>
<pre><code class=lang-json>{
  <span class=hljs-attr>"scripts"</span>: {
    <span class=hljs-attr>"build"</span>: <span class=hljs-string>"rollup -c"</span>
  },
}
</code></pre>
<h2 id="t42. rollup插件">2. rollup插件 <a href=#t42.%20rollup%E6%8F%92%E4%BB%B6 class=sf-hidden> # </a></h2>
<ul>
<li><a href=https://rollupjs.org/guide/en/#plugins-overview>Rollup 插件</a>是一个具有以下描述的一个或多个<code>属性</code>、<code>构建钩子</code>和<code>输出生成钩子</code>的对象，它遵循我们的约定。插件应该作为一个包分发，该包导出一个可以使用插件特定选项调用的函数并返回这样一个对象</li>
<li><a href=https://github.com/rollup/awesome>插件列表</a></li>
</ul>
<h3 id="t52.1 插件规范">2.1 插件规范 <a href=#t52.1%20%E6%8F%92%E4%BB%B6%E8%A7%84%E8%8C%83 class=sf-hidden> # </a></h3>
<ul>
<li>插件应该有一个清晰的名称，带有<code>rollup-plugin-prefix</code></li>
<li>在package.json中包含插件关键字</li>
<li>插件应该经过测试。我们推荐mocha或ava，它们支持开箱即用的Promise</li>
<li>尽可能使用异步方法。</li>
<li>编写英文文档</li>
<li>如果合适的话，确保你的插件输出正确的<code>sourcemap</code></li>
<li>如果您的插件使用“虚拟模块”（例如，用于辅助功能），请在模块ID前面加上<code>\0</code>。这会阻止其他插件尝试处理它</li>
</ul>
<h3 id=t62.2.插件属性>2.2.插件属性 <a href=#t62.2.%E6%8F%92%E4%BB%B6%E5%B1%9E%E6%80%A7 class=sf-hidden> # </a></h3>
<h4 id="t72.2.1 name">2.2.1 name <a href=#t72.2.1%20name class=sf-hidden> # </a></h4>
<ul>
<li>插件的名称，用于错误消息和警告</li>
<li>Type: 字符串</li>
</ul>
<h3 id="t82.2 Build Hooks">2.2 Build Hooks <a href=#t82.2%20Build%20Hooks class=sf-hidden> # </a></h3>
<ul>
<li>为了与构建过程交互，你的插件对象包括“钩子”</li>
<li>钩子是在构建的不同阶段调用的函数</li>
<li>钩子可以影响构建的运行方式，提供关于构建的信息，或者在构建完成后修改构建</li>
<li>有不同种类的钩子<ul>
<li><code>async</code> 钩子还可以返回解析为相同类型值的<code>Promise</code>；否则，钩子将被标记为<code>sync</code></li>
<li><code>first</code> 如果有几个插件实现了这个钩子，钩子会按顺序运行，直到钩子返回一个<code>非null</code>或未定义的值</li>
<li><code>sequential</code> 如果几个插件实现了这个钩子，那么它们都将按照指定的插件顺序运行。如果一个钩子是异步的，那么这种类型的后续钩子将等待当前钩子被解析</li>
<li><code>parallel</code> 如果多个插件实现了这个钩子，那么它们都将按照指定的插件顺序运行。如果一个钩子是异步的，那么这类后续钩子将并行运行，而不是等待当前钩子</li>
</ul>
</li>
<li><code>Build Hooks</code>在构建阶段运行，该阶段由<code>rollup.rollup(inputOptions)</code>触发</li>
<li>它们主要负责在<code>rollup</code>处理输入文件之前定位、提供和转换输入文件</li>
<li>构建阶段的第一个钩子是<code>options</code>，最后一个钩子总是<code>buildEnd</code></li>
<li>如果出现生成错误，将在此之后调用<code>closeBundle</code></li>
</ul>
<h4 id="t92.2.1 rollup-plugin-build.js">2.2.1 rollup-plugin-build.js <a href=#t92.2.1%20rollup-plugin-build.js class=sf-hidden> # </a></h4>
<p>plugins\rollup-plugin-build.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> fs <span class=hljs-keyword>from</span> <span class=hljs-string>'fs'</span>;

<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>build</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'build'</span>,
    <span class=hljs-keyword>async</span> watchChange(id, change) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'watchChange'</span>, id, change);
    },
    <span class=hljs-keyword>async</span> closeWatcher() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'closeWatcher'</span>);
    },
    <span class=hljs-keyword>async</span> options(inputOptions) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'options'</span>);
      <span class=hljs-comment>//inputOptions.input = './src/main.js';</span>
    },
    <span class=hljs-keyword>async</span> buildStart(inputOptions) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'buildStart'</span>);
    },
    <span class=hljs-keyword>async</span> resolveId(source, importer) {
      <span class=hljs-keyword>if</span> (source === <span class=hljs-string>'virtual'</span>) {
        <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'resolveId'</span>, source);
        <span class=hljs-comment>//如果resolveId钩子有返回值了，那么就会跳过后面的查找逻辑，以此返回值作为最终的模块ID</span>
        <span class=hljs-keyword>return</span> source;
      }
    },
    <span class=hljs-comment>//加载此模块ID对应的内容</span>
    <span class=hljs-keyword>async</span> load(id) {
      <span class=hljs-keyword>if</span> (id === <span class=hljs-string>'virtual'</span>) {
        <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'load'</span>, id);
        <span class=hljs-keyword>return</span> <span class=hljs-string>`export default "virtual"`</span>;
      }
    },
    <span class=hljs-keyword>async</span> shouldTransformCachedModule({ id, code, ast }) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'shouldTransformCachedModule'</span>);
      <span class=hljs-comment>//不使用缓存，再次进行转换</span>
      <span class=hljs-keyword>return</span> <span class=hljs-literal>true</span>;
    },
    <span class=hljs-keyword>async</span> transform(code, id) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'transform'</span>);
    },
    <span class=hljs-keyword>async</span> moduleParsed(moduleInfo) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'moduleParsed'</span>);
    },
    <span class=hljs-keyword>async</span> resolveDynamicImport(specifier, importer) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'resolveDynamicImport'</span>, specifier, importer);
    },
    <span class=hljs-keyword>async</span> buildEnd() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'buildEnd'</span>);
    }
  }
}
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> build;
</code></pre>
<h4 id="t102.2.2 rollup.config.js">2.2.2 rollup.config.js <a href=#t102.2.2%20rollup.config.js class=sf-hidden> # </a></h4>
<p>rollup.config.js</p>
<pre><code class=lang-diff><span class=hljs-addition>+import build from './plugins/rollup-plugin-build.js';</span>
export default {
  input: "./src/index.js",
  output: [{
    dir: 'dist',
  }],
  plugins: [
<span class=hljs-addition>+   build()</span>
  ]
}
</code></pre>
<h4 id="t112.2.3 options">2.2.3 options <a href=#t112.2.3%20options class=sf-hidden> # </a></h4>
<ul>
<li><a href=https://rollupjs.org/guide/en/#big-list-of-options>big-list-of-options</a></li>
</ul>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(options: InputOptions) =&gt; InputOptions</td>
<td>null</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, sequential</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>这是构建阶段的第一个钩子</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>buildStart</td>
</tr>
</tbody>
</table>
<ul>
<li>替换或操作传递给<code>rollup</code>的选项对象</li>
<li>返回<code>null</code>的话rollup不会替换任何内容</li>
<li>如果只需要阅读<code>options</code>，建议使用<code>buildStart</code>钩子，因为在考虑了所有选项钩子的转换后，该钩子可以访问选项</li>
<li>这是唯一一个无法访问大多数插件上下文实用程序功能的钩子，因为它是在完全配置汇总之前运行的</li>
</ul>
<h4 id="t122.2.4 buildStart">2.2.4 buildStart <a href=#t122.2.4%20buildStart class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(options: InputOptions) =&gt; void</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>options</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>resolveId并行解析每个入口点</td>
</tr>
</tbody>
</table>
<ul>
<li>每次<code>rollup.rollup build</code>都要调用此钩子</li>
<li>当您需要访问传递给rollup的选项时，建议使用这个钩子</li>
<li>因为它考虑了所有<code>options</code>钩子的转换，还包含未设置选项的正确默认值</li>
</ul>
<p>build\plugin-buildStart.js</p>
<pre><code class=lang-js><span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>buildStart</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'buildStart'</span>,
    buildStart(InputOptions) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'buildStart'</span>, InputOptions);
    }
  };
}

</code></pre>
<h4 id="t132.2.5 resolveId">2.2.5 resolveId <a href=#t132.2.5%20resolveId class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(source, importer) =&gt; string</td>
<td>false</td>
<td>null</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, first</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>buildStart</code>(如果我们正在解析入口点)，<code>moduleParsed</code>（如果我们正在解析导入），或者作为<code>resolveDynamicImport</code>的后备方案。此外，这个钩子可以在构建阶段通过调用插件钩子触发。<code>emitFile</code>发出一个入口点，或在任何时候通过调用此。<code>resolve</code>可手动解析id</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>如果解析的<code>id</code>尚未加载，则<code>load</code>，否则<code>buildEnd</code></td>
</tr>
</tbody>
</table>
<ul>
<li>定义自定义解析器</li>
<li>解析程序可用于定位第三方依赖关系等。这里<code>source</code>是导入语句中所写的导入对象，即</li>
<li><p>来源就是 <code>"../bar.js"</code></p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> { foo } <span class=hljs-keyword>from</span> <span class=hljs-string>'../bar.js'</span>;
</code></pre>
</li>
<li><p><code>importer</code>是导入模块的完全解析id</p>
</li>
<li>在解析入口点时，<code>importer</code>通常是undefined</li>
<li>这里的一个例外是通过<code>this.emitFile</code>生成的入口点。在这里，您可以提供一个<code>importer</code>参数</li>
<li>对于这些情况，<code>isEntry</code>选项将告诉您，我们是否正在解析用户定义的入口点、发出的块，或者是否为此提供了<code>isEntry</code>参数。解析上下文函数</li>
<li>例如，您可以将其用作为入口点定义自定义代理模块的机制。以下插件将代理所有入口点以注入<code>polyfill</code>导入</li>
<li>返回<code>null</code>将遵循其他<code>resolveId</code>函数，最终遵循默认的解析行</li>
<li>返回<code>false</code>信号，表示源应被视为<code>外部模块</code>，不包括在<code>bundle</code>中</li>
</ul>
<p>index.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> virtual <span class=hljs-keyword>from</span> <span class=hljs-string>'virtual-module'</span>
<span class=hljs-built_in>console</span>.log(virtual);
</code></pre>
<p>build\plugin-polyfill.js</p>
<pre><code class=lang-js><span class=hljs-comment>//我们在polyfill id前面加上\0，告诉其他插件不要尝试加载或转换它</span>
<span class=hljs-keyword>const</span> POLYFILL_ID = <span class=hljs-string>'\0polyfill'</span>;
<span class=hljs-keyword>const</span> PROXY_SUFFIX = <span class=hljs-string>'?inject-polyfill-proxy'</span>;

<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>injectPolyfillPlugin</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'inject-polyfill'</span>,
    <span class=hljs-keyword>async</span> resolveId(source, importer, options) {
      <span class=hljs-keyword>if</span> (source === POLYFILL_ID) {
        <span class=hljs-comment>//重要的是，对于polyfills，应始终考虑副作用</span>
        <span class=hljs-comment>//否则，使用`treeshake.moduleSideEffects:false`可能会阻止包含polyfill</span>
        <span class=hljs-keyword>return</span> { <span class=hljs-attr>id</span>: POLYFILL_ID, <span class=hljs-attr>moduleSideEffects</span>: <span class=hljs-literal>true</span> };
      }
      <span class=hljs-keyword>if</span> (options.isEntry) {
        <span class=hljs-comment>//确定实际的入口是什么。我们需要skipSelf来避免无限循环。</span>
        <span class=hljs-keyword>const</span> resolution = <span class=hljs-keyword>await</span> <span class=hljs-keyword>this</span>.resolve(source, importer, { <span class=hljs-attr>skipSelf</span>: <span class=hljs-literal>true</span>, ...options });
        <span class=hljs-comment>//如果它无法解决或是外部的，只需返回它，这样Rollup就可以显示错误</span>
        <span class=hljs-keyword>if</span> (!resolution || resolution.external) <span class=hljs-keyword>return</span> resolution;
        <span class=hljs-comment>//在代理的加载钩子中，我们需要知道入口是否有默认导出</span>
        <span class=hljs-comment>//然而，在那里，我们不再有完整的“解析”对象，它可能包含来自其他插件的元数据，这些插件只在第一次加载时添加</span>
        <span class=hljs-comment>//仅在第一次加载时添加。因此我们在这里触发加载。</span>
        <span class=hljs-keyword>const</span> moduleInfo = <span class=hljs-keyword>await</span> <span class=hljs-keyword>this</span>.load(resolution);
        <span class=hljs-comment>//我们需要确保即使对于treeshake来说，原始入口点的副作用也得到了考虑。moduleSideEffects:false。</span>
        <span class=hljs-comment>//moduleSideEffects是ModuleInfo上的一个可写属性</span>
        moduleInfo.moduleSideEffects = <span class=hljs-literal>true</span>;
        <span class=hljs-comment>//重要的是，新入口不能以\0开头，并且与原始入口具有相同的目录，以免扰乱相对外部导入的生成</span>
        <span class=hljs-comment>//此外，保留名称并在末尾添加一个“？查询”可以确保preserveModules将为该条目生成原始条目名称</span>
        <span class=hljs-keyword>return</span> <span class=hljs-string>`<span class=hljs-subst>${resolution.id}</span><span class=hljs-subst>${PROXY_SUFFIX}</span>`</span>;
      }
      <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
    },
    load(id) {
      <span class=hljs-keyword>if</span> (id === POLYFILL_ID) {
        <span class=hljs-comment>// 替换为实际的polyfill import '@babel/polyfill'</span>
        <span class=hljs-keyword>return</span> <span class=hljs-string>"console.log('polyfill');"</span>;
      }
      <span class=hljs-keyword>if</span> (id.endsWith(PROXY_SUFFIX)) {
        <span class=hljs-keyword>const</span> entryId = id.slice(<span class=hljs-number>0</span>, -PROXY_SUFFIX.length);
        <span class=hljs-comment>//我们知道ModuleInfo.hasDefaultExport是可靠的，因为我们在等待在resolveId中的this.load</span>
        <span class=hljs-comment>// We know ModuleInfo.hasDefaultExport is reliable because we awaited this.load in resolveId</span>
        <span class=hljs-keyword>const</span> { hasDefaultExport } = <span class=hljs-keyword>this</span>.getModuleInfo(entryId);
        <span class=hljs-keyword>let</span> code =
          <span class=hljs-string>`import <span class=hljs-subst>${<span class=hljs-built_in>JSON</span>.stringify(POLYFILL_ID)}</span>;`</span> + <span class=hljs-string>`export * from <span class=hljs-subst>${<span class=hljs-built_in>JSON</span>.stringify(entryId)}</span>;`</span>;
        <span class=hljs-comment>//命名空间重新导出不会重新导出默认值，因此我们需要在这里进行特殊处理</span>
        <span class=hljs-keyword>if</span> (hasDefaultExport) {
          code += <span class=hljs-string>`export { default } from <span class=hljs-subst>${<span class=hljs-built_in>JSON</span>.stringify(entryId)}</span>;`</span>;
        }
        <span class=hljs-keyword>return</span> code;
      }
      <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
    }
  };
}
</code></pre>
<h4 id="t142.2.6 load">2.2.6 load <a href=#t142.2.6%20load class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left></td>
<td style=text-align:left>(id) =&gt; string</td>
<td>null</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, first</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>解析加载id的<code>resolveId</code>或<code>resolveDynamicImport</code>。此外，这个钩子可以在任何时候从插件钩子中通过调用<code>this.load</code>来触发预加载与id对应的模块</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>transform</code>可在未使用缓存或没有使用相同代码的缓存副本时转换加载的文件，否则应使用<code>TransformCachedModule</code></td>
</tr>
</tbody>
</table>
<ul>
<li>定义自定义加载程序</li>
<li>返回<code>null</code>会推迟到其他加载函数（最终是从文件系统加载的默认行为）</li>
<li>为了防止额外的解析开销，例如这个钩子已经使用了这个。parse出于某种原因，为了生成AST，这个钩子可以选择性地返回<code>{code，AST，map}</code>对象。<code>ast</code>必须是标准的<code>ESTree ast</code>，每个节点都有开始和结束属性。如果转换不移动代码，可以通过将map设置为null来保留现有的sourcemaps。否则，您可能需要生成源映射。请参阅关于源代码转换的部分</li>
</ul>
<h4 id="t152.2.7 transform">2.2.7 transform <a href=#t152.2.7%20transform class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(code, id) =&gt; string</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, sequential</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>load</code> 当前处理的文件的位置。如果使用了缓存，并且有该模块的缓存副本，那么如果插件为该钩子返回true，则应<code>shouldTransformCachedModule</code></td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>moduleParsed</code> 一旦文件被处理和解析，模块就会被解析</td>
</tr>
</tbody>
</table>
<ul>
<li>可用于转换单个模块</li>
<li>为了防止额外的解析开销，例如这个钩子已经使用了<code>this.parse</code>出于某种原因，为了生成AST</li>
<li>这个钩子可以选择性地返回<code>{code，AST，map}</code>对象</li>
<li>ast必须是标准的ESTree ast，每个节点都有<code>start</code>和<code>end</code>属性</li>
<li>如果转换不移动代码，可以通过将map设置为null来保留现有的sourcemaps。否则，您可能需要生成源映射。请参阅关于源代码转换的部分</li>
</ul>
<p>plugins\rollup-plugin-babel.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> { createFilter } <span class=hljs-keyword>from</span> <span class=hljs-string>'rollup-pluginutils'</span>
<span class=hljs-keyword>import</span> babel <span class=hljs-keyword>from</span> <span class=hljs-string>'@babel/core'</span>
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>plugin</span>(<span class=hljs-params>pluginOptions = {}</span>) </span>{
  <span class=hljs-keyword>const</span> defaultExtensions = [<span class=hljs-string>'.js'</span>, <span class=hljs-string>'.jsx'</span>]
  <span class=hljs-keyword>const</span> { exclude, include, extensions = defaultExtensions } = pluginOptions;
  <span class=hljs-keyword>const</span> extensionRegExp = <span class=hljs-keyword>new</span> <span class=hljs-built_in>RegExp</span>(<span class=hljs-string>`(<span class=hljs-subst>${extensions.join(<span class=hljs-string>'|'</span>)}</span>)$`</span>)
  <span class=hljs-keyword>const</span> userDefinedFilter = createFilter(include, exclude);
  <span class=hljs-keyword>const</span> filter = <span class=hljs-function><span class=hljs-params>id</span> =&gt;</span> extensionRegExp.test(id) &amp;&amp; userDefinedFilter(id);
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'babel'</span>,
    <span class=hljs-keyword>async</span> transform(code, filename) {
      <span class=hljs-keyword>if</span> (!filter(filename)) <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
      <span class=hljs-keyword>let</span> result = <span class=hljs-keyword>await</span> babel.transformAsync(code);
      <span class=hljs-keyword>return</span> result
    }
  }
}
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> plugin
</code></pre>
<h4 id="t162.2.8 shouldTransformCachedModule">2.2.8 shouldTransformCachedModule <a href=#t162.2.8%20shouldTransformCachedModule class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>({id, code, ast, resoledSources, moduleSideEffects, syntheticNamedExports) =&gt; boolean</td>
</tr>
<tr>
<td style=text-align:left>Kind: async, first</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>load</code> 加载缓存文件以将其代码与缓存版本进行比较的位置</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>moduleParsed</code> if no plugin returns true, otherwise <code>transform</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li>如果使用了<code>Rollup</code>缓存（例如，在监视模式下或通过JavaScript API显式使用），如果在加载钩子之后，加载的代码与缓存副本的代码相同，则Rollup将跳过模块的转换钩子</li>
<li>为了防止这种情况，丢弃缓存的副本，而是转换一个模块，插件可以实现这个钩子并返回true。</li>
<li>这个钩子还可以用来找出缓存了哪些模块，并访问它们缓存的元信息</li>
<li>如果一个插件没有返回true，Rollup将触发其他插件的这个钩子，否则将跳过所有剩余的插件。</li>
</ul>
<pre><code class=lang-js>npx rollup -c -w
shouldTransformCachedModule
transform
moduleParsed

shouldTransformCachedModule
moduleParsed
</code></pre>
<h4 id="t172.2.9 moduleParsed">2.2.9 moduleParsed <a href=#t172.2.9%20moduleParsed class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(moduleInfo: ModuleInfo) =&gt; void</td>
</tr>
<tr>
<td style=text-align:left>Kind: async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>transform</code> 转换当前处理的文件的位置</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>resolveId</code> 和 <code>resolveDynamicImport</code> 并行解析所有发现的静态和动态导入（如果存在），否则buildEnd</td>
</tr>
</tbody>
</table>
<ul>
<li>每当模块被<code>Rollup</code>完全解析时，就会调用这个钩子。看看<code>this.getModuleInfo</code>了解传递给这个钩子的信息</li>
<li>与<code>transform</code>钩子不同，这个钩子从不缓存，可以用来获取缓存模块和其他模块的信息，包括元属性的最终形状、代码和ast</li>
</ul>
<h4 id="t182.2.10 resolveDynamicImport">2.2.10 resolveDynamicImport <a href=#t182.2.10%20resolveDynamicImport class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(specifier, importer) =&gt; string</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, first</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>moduleParsed</code> 已为导入文件分配模块</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>load</code> 如果钩子使用尚未加载的id ,如果动态导入包含字符串且钩子未解析，请加载<code>resolveId</code>，否则为<code>buildEnd</code></td>
</tr>
</tbody>
</table>
<ul>
<li>为动态导入定义自定义解析程序</li>
<li>返回<code>false</code>表明导入应该保持原样，而不是传递给其他解析程序，从而使其成为外部的</li>
<li>与<code>resolveId</code>钩子类似，还可以返回一个对象，将导入解析为不同的id，同时将其标记为外部</li>
<li>如果动态导入被传递一个字符串作为参数，那么从这个钩子返回的字符串将被解释为一个现有的模块id，而返回null将推迟到其它解析器resolveId</li>
</ul>
<p>index.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span>(<span class=hljs-string>'./msg.js'</span>).then(<span class=hljs-function><span class=hljs-params>res</span> =&gt;</span> <span class=hljs-built_in>console</span>.log(res))
</code></pre>
<h4 id="t192.2.11 buildEnd">2.2.11 buildEnd <a href=#t192.2.11%20buildEnd class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(error) =&gt; void</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>moduleParsed, resolveId or resolveDynamicImport.</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>outputOptions 输出生成阶段的输出，因为这是构建阶段的最后一个挂钩</td>
</tr>
</tbody>
</table>
<ul>
<li>在<code>rollup</code>完成打包时调用，但在调用<code>generate</code>或<code>write</code>之前调用；你也可以返回一个<code>Promise</code></li>
<li>如果在构建过程中发生错误，则会将其传递给此钩子</li>
</ul>
<h3 id="t202.3 Output Generation Hooks">2.3 Output Generation Hooks <a href=#t202.3%20Output%20Generation%20Hooks class=sf-hidden> # </a></h3>
<ul>
<li>输出生成钩子可以提供有关生成的包的信息，并在完成后修改构建</li>
<li>输出生成阶段的第一个钩子是<code>outputOptions</code>，最后一个钩子要么<code>generateBundle</code>是通过成功生成输出</li>
<li>或者在输出生成过程中的任何时候发生错误 <code>renderError</code></li>
<li>此外，<code>closeBundle</code>可以作为最后一个钩子调用，但用户有责任手动调用<code>bundle.close()</code>以触发此钩子</li>
</ul>
<h4 id="t212.3.1 rollup-plugin-generation.js">2.3.1 rollup-plugin-generation.js <a href=#t212.3.1%20rollup-plugin-generation.js class=sf-hidden> # </a></h4>
<p>plugins\rollup-plugin-generation.js</p>
<pre><code class=lang-js><span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>generation</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'rollup-plugin-generation'</span>,
    <span class=hljs-comment>//这个钩子是同步的，不能加async</span>
    outputOptions(outputOptions) {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'outputOptions'</span>);
    },
    renderStart() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'renderStart'</span>);
    },
    banner() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'banner'</span>);
    },
    footer() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'footer'</span>);
    },
    intro() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'intro'</span>);
    },
    outro() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'outro'</span>);
    },
    renderDynamicImport() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'renderDynamicImport'</span>);
    },
    augmentChunkHash() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'augmentChunkHash'</span>);
    },
    resolveFileUrl() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'resolveFileUrl'</span>);
    },
    resolveImportMeta() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'resolveImportMeta'</span>);
    },
    renderChunk() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'renderChunk'</span>);
    },
    generateBundle() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'generateBundle'</span>);
    },
    writeBundle() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'writeBundle'</span>);
    },
    renderError() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'renderError'</span>);
    },
    closeBundle() {
      <span class=hljs-built_in>console</span>.log(<span class=hljs-string>'closeBundle'</span>);
    }
  }
}
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> generation;
</code></pre>
<h4 id="t222.3.2 rollup.config.js">2.3.2 rollup.config.js <a href=#t222.3.2%20rollup.config.js class=sf-hidden> # </a></h4>
<p>rollup.config.js</p>
<pre><code class=lang-diff>import build from './plugins/rollup-plugin-build.js';
<span class=hljs-addition>+import generation from './plugins/rollup-plugin-generation.js';</span>
export default {
  input: "./src/index.js",
  output: [{
    dir: 'dist',
  }],
  plugins: [
    build(),
<span class=hljs-addition>+   generation()</span>
  ]
}
</code></pre>
<h4 id="t232.3.3 outputOptions">2.3.3 outputOptions <a href=#t232.3.3%20outputOptions class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(outputOptions) =&gt; null</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>buildEnd</code>如果这是第一次生成输出，否则为<code>generateBundle</code>，<code>writeBundle</code>或<code>renderError</code>取决于先前生成的输出。这是输出生成阶段的第一个钩子</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>outputOptions</code> 输出生成阶段的输出，因为这是构建阶段的最后一个挂钩</td>
</tr>
</tbody>
</table>
<ul>
<li>替换或操作传递给<code>bundle.generate()</code>的输出选项对象<code>bundle.write()</code></li>
<li>返回<code>null</code>并不能代替任何东西</li>
<li>如果您只需要读取输出选项，建议使用<code>renderStart</code>钩子，因为在考虑<code>renderStart</code>所有钩子的转换后，此钩子可以访问输出选项</li>
</ul>
<h4 id="t242.3.4 renderStart">2.3.4 renderStart <a href=#t242.3.4%20renderStart class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(outputOptions, inputOptions) =&gt; void</td>
</tr>
<tr>
<td style=text-align:left>种类</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>上一个钩子</td>
<td style=text-align:left>outputOptions</td>
</tr>
<tr>
<td style=text-align:left>下一个钩子</td>
<td style=text-align:left>banner, footer, intro and outro 并行运行</td>
</tr>
</tbody>
</table>
<ul>
<li>每次初始调用<code>bundle.generate()</code>或被<code>bundle.write()</code>调用</li>
<li>要在生成完成时收到通知，请使用<code>generateBundle</code>和<code>renderError</code>挂钩</li>
<li>当您需要访问传递给的输出选项时，建议使用此挂钩.<code>bundle.generate()</code>或者<code>bundle.write()</code>因为它考虑了所有<code>outputOptions</code>挂钩的转换，并且还包含未设置选项的正确默认值。它还接收传递给的输入选项</li>
</ul>
<h4 id="t252.3.5 banner">2.3.5 banner <a href=#t252.3.5%20banner class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>string</td>
<td>(() =&gt; string)</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>renderStart</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>针对每个动态导入表达式 <code>renderDynamicImport</code></td>
</tr>
</tbody>
</table>
<h4 id="t262.3.6 footer">2.3.6 footer <a href=#t262.3.6%20footer class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>string</td>
<td>(() =&gt; string)</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>renderStart</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>针对每个动态导入表达式 <code>renderDynamicImport</code></td>
</tr>
</tbody>
</table>
<h4 id="t272.3.7 intro">2.3.7 intro <a href=#t272.3.7%20intro class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>string</td>
<td>(() =&gt; string)</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>renderStart</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>针对每个动态导入表达式 <code>renderDynamicImport</code></td>
</tr>
</tbody>
</table>
<h4 id="t282.3.8 outro">2.3.8 outro <a href=#t282.3.8%20outro class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>string</td>
<td>(() =&gt; string)</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>renderStart</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>针对每个动态导入表达式 <code>renderDynamicImport</code></td>
</tr>
</tbody>
</table>
<h4 id="t292.3.9 renderDynamicImport">2.3.9 renderDynamicImport <a href=#t292.3.9%20renderDynamicImport class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>({format, moduleId, targetModuleId, customResolution}) =&gt; {left: string, right: string}</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>banner , footer, intro, outro</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>augmentChunkHash</code>对于每个在文件名中包含哈希的块</td>
</tr>
</tbody>
</table>
<ul>
<li>这个钩子提供了对如何呈现动态导入的细粒度控制</li>
<li>方法是替换导入表达式参数的左侧 ( import() 和右侧 ( ) 的代码。)</li>
<li>返回null延迟到此类型的其他钩子并最终呈现特定于格式的默认值</li>
<li>format是渲染的输出格式</li>
<li>moduleId执行动态导入的模块的 id</li>
<li>如果导入可以解析为内部或外部 id，targetModuleId则将设置为此 id，否则将为null</li>
</ul>
<p>plugins\rollup-plugin-renderDynamicImport.js</p>
<pre><code class=lang-js><span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>dynamicImportPolyfillPlugin</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'dynamic-import-polyfill'</span>,
    renderDynamicImport() {
      <span class=hljs-keyword>return</span> {
        <span class=hljs-attr>left</span>: <span class=hljs-string>'dynamicImportPolyfill('</span>,
        <span class=hljs-attr>right</span>: <span class=hljs-string>', import.meta.url)'</span>
      };
    }
  };
}
</code></pre>
<pre><code class=lang-js>dynamicImportPolyfill(<span class=hljs-string>'./msg-ca034dda.js'</span>, <span class=hljs-keyword>import</span>.meta.url).then(<span class=hljs-function><span class=hljs-params>res</span> =&gt;</span> <span class=hljs-built_in>console</span>.log(res.default));
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>dynamicImportPolyfill</span>(<span class=hljs-params>filename, url</span>) </span>{
  <span class=hljs-keyword>return</span> <span class=hljs-keyword>new</span> <span class=hljs-built_in>Promise</span>(<span class=hljs-function>(<span class=hljs-params>resolve</span>) =&gt;</span> {
    <span class=hljs-keyword>const</span> script = <span class=hljs-built_in>document</span>.createElement(<span class=hljs-string>"script"</span>);
    script.type = <span class=hljs-string>"module"</span>;
    script.onload = <span class=hljs-function><span class=hljs-params>()</span> =&gt;</span> {
      resolve(<span class=hljs-built_in>window</span>.mod);
    };
    <span class=hljs-keyword>const</span> absURL = <span class=hljs-keyword>new</span> URL(filename, url).href;
    <span class=hljs-built_in>console</span>.log(absURL);
    <span class=hljs-keyword>const</span> blob = <span class=hljs-keyword>new</span> Blob([
      <span class=hljs-string>`import * as mod from "<span class=hljs-subst>${absURL}</span>";`</span>,
      <span class=hljs-string>` window.mod = mod;`</span>], { <span class=hljs-attr>type</span>: <span class=hljs-string>"text/javascript"</span> });
    script.src = URL.createObjectURL(blob);
    <span class=hljs-built_in>document</span>.head.appendChild(script);
  });
}
</code></pre>
<h4 id="t302.3.9 augmentChunkHash">2.3.9 augmentChunkHash <a href=#t302.3.9%20augmentChunkHash class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(chunkInfo: ChunkInfo) =&gt; string</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>sync, sequential</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>renderDynamicImport针对每个动态导入表达式</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>resolveFileUrl</code>对于每次使用<code>import.meta.ROLLUP_FILE_URL_referenceId</code>和<code>resolveImportMeta</code>所有其他访问<code>import.meta</code></td>
</tr>
</tbody>
</table>
<ul>
<li>可用于增加单个块的散列</li>
<li>为每个<code>Rollup</code>输出块调用</li>
<li>返回一个<code>false</code>值不会修改散列</li>
<li>真实值将传递给<code>hash.update</code>.</li>
<li>这<code>chunkInfo</code>是<code>generateBundle</code>不依赖文件名的属性的简化版本</li>
</ul>
<h4 id="t312.3.10 resolveFileUrl">2.3.10 resolveFileUrl <a href=#t312.3.10%20resolveFileUrl class=sf-hidden> # </a></h4>
<ul>
<li><a href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import.meta>import.meta</a>是一个给JavaScript模块暴露特定上下文的元数据属性的对象。它包含了这个模块的信息，比如说这个模块的URL。</li>
</ul>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>({chunkId, fileName, format, moduleId, referenceId, relativePath}) =&gt; string</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>sync, first</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>augmentChunkHash</code>对于在文件名中包含哈希的每个块</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>renderChunk</code>对于每个块</td>
</tr>
</tbody>
</table>
<ul>
<li>允许自定义Rollup如何解析插件通过此链接发出的文件的URL<code>this.emitFile</code></li>
<li>默认情况下，Rollup 将生成代码</li>
<li><code>import.meta.ROLLUP_FILE_URL_referenceId</code>该代码应正确生成发出文件的绝对URL，而与输出格式和部署代码的主机系统无关</li>
</ul>
<p>src\index.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> logger <span class=hljs-keyword>from</span> <span class=hljs-string>'logger'</span>
<span class=hljs-built_in>console</span>.log(logger);
</code></pre>
<p>plugins\rollup-plugin-resolveFileUrl.js</p>
<pre><code class=lang-js><span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>resolveFileUrl</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'resolveFileUrl'</span>,
    resolveId(source) {
      <span class=hljs-keyword>if</span> (source === <span class=hljs-string>'logger'</span>) {
        <span class=hljs-keyword>return</span> source;
      }
    },
    load(importee) {
      <span class=hljs-keyword>if</span> (importee === <span class=hljs-string>'logger'</span>) {
        <span class=hljs-keyword>let</span> referenceId = <span class=hljs-keyword>this</span>.emitFile({ <span class=hljs-attr>type</span>: <span class=hljs-string>'asset'</span>, <span class=hljs-attr>source</span>: <span class=hljs-string>'console.log("logger")'</span>, <span class=hljs-attr>fileName</span>: <span class=hljs-string>"logger.js"</span> });
        <span class=hljs-keyword>return</span> <span class=hljs-string>`export default import.meta.ROLLUP_FILE_URL_<span class=hljs-subst>${referenceId}</span>`</span>;
      }
    },
    resolveFileUrl({ chunkId, fileName, format, moduleId, referenceId, relativePath }) {<span class=hljs-comment>//import.meta.url</span>
      <span class=hljs-keyword>return</span> <span class=hljs-string>`new URL('<span class=hljs-subst>${fileName}</span>', document.baseURI).href`</span>;
    }
  };
}
</code></pre>
<h4 id="t322.3.11 resolveImportMeta">2.3.11 resolveImportMeta <a href=#t322.3.11%20resolveImportMeta class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(property, {chunkId, moduleId, format}) =&gt; string</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>sync, first</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>augmentChunkHash</code>对于在文件名中包含哈希的每个块</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>renderChunk</code>对于每个块</td>
</tr>
</tbody>
</table>
<ul>
<li>允许自定义 Rollup 如何处理<code>import.meta</code>,<code>import.meta.someProperty</code>特别是<code>import.meta.url</code></li>
<li>在 ES 模块中，<code>import.meta</code>是一个对象，<code>import.meta.url</code>包含当前模块的 URL</li>
</ul>
<h4 id="t332.3.12 renderChunk">2.3.12 renderChunk <a href=#t332.3.12%20renderChunk class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(code, chunk, options) =&gt; string</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, sequential</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>resolveFileUrl</code>对于 . 的每次使用<code>import.meta.ROLLUP_FILE_URL_referenceId</code>和<code>resolveImportMeta</code>所有其他访问<code>import.meta</code></td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>generateBundle</code></td>
</tr>
</tbody>
</table>
<ul>
<li>可用于转换单个块</li>
<li>为每个<code>rollup</code>输出块文件调用。返回null将不应用任何转换</li>
</ul>
<h4 id="t342.3.13 generateBundle">2.3.13 generateBundle <a href=#t342.3.13%20generateBundle class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(options, bundle, isWrite) =&gt; void</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, sequential</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>renderChunk对于每个块</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>writeBundle</code>如果输出是通过生成的，否则这是输出生成阶段的最后一个钩子，如果生成另一个输出<code>bundle.write()</code>，可能会再次跟随<code>outputOptions</code></td>
</tr>
</tbody>
</table>
<ul>
<li>在<code>bundle.generate()</code>之后调用</li>
<li>或者在 <code>bundle.write()</code>把文件写入之前调用</li>
<li>要在写入文件后修改文件，请使用<code>writeBundle</code>挂钩</li>
<li><code>writeBundle</code>提供正在写入或生成的文件的完整列表及其详细信息</li>
<li>您可以通过从该钩子中的捆绑对象中删除文件来防止发出文件。要发出其他文件，请使用<code>this.emitFile</code>插件上下文功能</li>
</ul>
<p>plugins\rollup-plugin-html.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> dedent <span class=hljs-keyword>from</span> <span class=hljs-string>'dedent'</span>;
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>html</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'html'</span>,
    generateBundle(options, bundle) {
      <span class=hljs-keyword>let</span> entryName;
      <span class=hljs-keyword>for</span> (<span class=hljs-keyword>let</span> fileName <span class=hljs-keyword>in</span> bundle) {
        <span class=hljs-keyword>let</span> assetOrChunkInfo = bundle[fileName];
        <span class=hljs-comment>//console.log(fileName, assetOrChunkInfo);</span>
        <span class=hljs-keyword>if</span> (assetOrChunkInfo.isEntry) {
          entryName = fileName;
        }
      }
      <span class=hljs-keyword>this</span>.emitFile({
        <span class=hljs-attr>type</span>: <span class=hljs-string>'asset'</span>,
        <span class=hljs-attr>fileName</span>: <span class=hljs-string>'index.html'</span>,
        <span class=hljs-attr>source</span>: dedent<span class=hljs-string>`
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
        &lt;head&gt;
          &lt;meta charset="UTF-8"&gt;
          &lt;title&gt;rollup&lt;/title&gt;
         &lt;/head&gt;
        &lt;body&gt;
          &lt;script src="<span class=hljs-subst>${entryName}</span>" type="module"&gt;&lt;/script&gt;
        &lt;/body&gt;
        &lt;/html&gt;`</span>
      });
    }
  };
}
</code></pre>
<h4 id="t352.3.14 writeBundle">2.3.14 writeBundle <a href=#t352.3.14%20writeBundle class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(options,bundle) =&gt; void</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>generateBundle</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left>如果被调用，这是输出生成阶段的最后一个钩子，如果生成另一个输出，可能会再次跟随<code>outputOptions</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>bundle.write()</code>仅在写入所有文件后才调用</li>
<li>与<code>generateBundle</code>钩子类似，<code>bundle</code>提供正在写入的文件的完整列表及其详细信息</li>
</ul>
<h4 id="t362.3.15 renderError">2.3.15 renderError <a href=#t362.3.15%20renderError class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>(error: Error) =&gt; void</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left>renderStart从到 的任何钩子renderChunk</td>
</tr>
<tr>
<td style=text-align:left>Next Hook</td>
<td style=text-align:left><code>outputOptions</code>如果它被调用，这是输出生成阶段的最后一个钩子，如果生成另一个输出，可能会再次跟随</td>
</tr>
</tbody>
</table>
<ul>
<li><code>bundle.generate()</code>当 rollup 在或期间遇到错误时调用<code>bundle.write()</code></li>
<li>错误被传递给这个钩子。要在生成成功完成时收到通知，请使用<code>generateBundle</code>钩子</li>
</ul>
<h4 id="t372.3.16 closeBundle">2.3.16 closeBundle <a href=#t372.3.16%20closeBundle class=sf-hidden> # </a></h4>
<table>
<thead>
<tr>
<th style=text-align:left>字段</th>
<th style=text-align:left>值</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Type</td>
<td style=text-align:left>closeBundle: () =&gt; Promise<void></void></td>
<td>void</td>
</tr>
<tr>
<td style=text-align:left>Kind</td>
<td style=text-align:left>async, parallel</td>
</tr>
<tr>
<td style=text-align:left>Previous Hook</td>
<td style=text-align:left><code>buildEnd</code> 如果有构建错误.否则何时bundle.close()被调用，在这种情况下，这将是最后一个被触发的钩子。</td>
</tr>
</tbody>
</table>
<ul>
<li>可用于清理可能正在运行的任何外部服务</li>
<li><code>Rollup</code> 的 <code>CLI</code> 将确保在每次运行后调用此钩子</li>
<li>但 <code>JavaScript API</code> 的用户有责任在<code>bundle.close()</code>他们完成生成包后手动调用</li>
</ul>
<h2 id="t383.Plugin Context">3.Plugin Context <a href=#t383.Plugin%20Context class=sf-hidden> # </a></h2>
<h3 id="t393.1 this.emitFile">3.1 this.emitFile <a href=#t393.1%20this.emitFile class=sf-hidden> # </a></h3>
<ul>
<li><a href=https://rollupjs.org/guide/en/#thisemitfile>thisemitfile</a></li>
<li>Type: (emittedFile: EmittedChunk | EmittedAsset) =&gt; string</li>
<li>发出一个包含在生成输出中的新文件，并返回一个referenceId，该ID可在不同位置用于引用发出的文件</li>
<li>emittedFile 可以有两种形式之一</li>
</ul>
<pre><code class=lang-js>type EmittedChunk = {
  <span class=hljs-attr>type</span>: <span class=hljs-string>'chunk'</span>;
  id: string;
  name?: string;
  fileName?: string;
};

type EmittedAsset = {
  <span class=hljs-attr>type</span>: <span class=hljs-string>'asset'</span>;
  name?: string;
  fileName?: string;
  source?: string | <span class=hljs-built_in>Uint8Array</span>;
};
</code></pre>
<h3 id="t403.2 this.load">3.2 this.load <a href=#t403.2%20this.load class=sf-hidden> # </a></h3>
<ul>
<li><a href=https://rollupjs.org/guide/en/#thisgetmoduleinfo>thisgetmoduleinfo</a></li>
<li>Type: (moduleId: string) =&gt; (ModuleInfo | null)</li>
<li>返回有关相关模块的其他信息</li>
</ul>
<h3 id="t413.3 this.load">3.3 this.load <a href=#t413.3%20this.load class=sf-hidden> # </a></h3>
<ul>
<li><a href=https://rollupjs.org/guide/en/#thisload>thisload</a></li>
<li>Type: ({id: string, moduleSideEffects?: boolean | 'no-treeshake' | null, syntheticNamedExports?: boolean | string | null, meta?: {[plugin: string]: any} | null, resolveDependencies?: boolean}) =&gt; Promise<moduleinfo></moduleinfo></li>
<li>加载并解析与给定id对应的模块，并将附加的元信息附加到模块（如果提供）</li>
<li>这将触发与另一个模块导入该模块时相同的加载、转换和模块授权挂钩</li>
</ul>
<h3 id="t423.4 this.resolve">3.4 this.resolve <a href=#t423.4%20this.resolve class=sf-hidden> # </a></h3>
<ul>
<li><a href=https://rollupjs.org/guide/en/#thisresolve>thisresolve</a></li>
<li>使用Rollup使用的相同插件将导入解析为模块ID（即文件名），并确定导入是否应该是外部的</li>
<li>如果返回null，则无法通过Rollup或任何插件解析导入，但用户未明确将其标记为外部</li>
</ul>
<h2 id=t434.实战案例>4.实战案例 <a href=#t434.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B class=sf-hidden> # </a></h2>
<h3 id="t444.1 @rollup/plugin-babel">4.1 @rollup/plugin-babel <a href=#t444.1%20@rollup/plugin-babel class=sf-hidden> # </a></h3>
<h4 id="t454.1.1 安装">4.1.1 安装 <a href=#t454.1.1%20%E5%AE%89%E8%A3%85 class=sf-hidden> # </a></h4>
<pre><code class=lang-js>pnpm install rollup-pluginutils @rollup/plugin-babel @babel/core @babel/preset-env  -D
</code></pre>
<h4 id="t464.1.2 rollup-plugin-babel.js">4.1.2 rollup-plugin-babel.js <a href=#t464.1.2%20rollup-plugin-babel.js class=sf-hidden> # </a></h4>
<p>plugins\rollup-plugin-babel.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> { createFilter } <span class=hljs-keyword>from</span> <span class=hljs-string>'rollup-pluginutils'</span>
<span class=hljs-keyword>import</span> babel <span class=hljs-keyword>from</span> <span class=hljs-string>'@babel/core'</span>
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>plugin</span>(<span class=hljs-params>pluginOptions = {}</span>) </span>{
  <span class=hljs-keyword>const</span> defaultExtensions = [<span class=hljs-string>'.js'</span>, <span class=hljs-string>'.jsx'</span>]
  <span class=hljs-keyword>const</span> { exclude, include, extensions = defaultExtensions } = pluginOptions;
  <span class=hljs-keyword>const</span> extensionRegExp = <span class=hljs-keyword>new</span> <span class=hljs-built_in>RegExp</span>(
    <span class=hljs-string>`(<span class=hljs-subst>${extensions.join(<span class=hljs-string>'|'</span>)}</span>)$`</span>
  )
  <span class=hljs-keyword>const</span> userDefinedFilter = createFilter(include, exclude);
  <span class=hljs-keyword>const</span> filter = <span class=hljs-function><span class=hljs-params>id</span> =&gt;</span> extensionRegExp.test(id) &amp;&amp; userDefinedFilter(id);
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'babel'</span>,
    <span class=hljs-keyword>async</span> transform(code, filename) {
      <span class=hljs-keyword>if</span> (!filter(filename)) <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
      <span class=hljs-keyword>let</span> result = <span class=hljs-keyword>await</span> babel.transformAsync(code);
      <span class=hljs-keyword>return</span> result
    }
  }
}
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> plugin
</code></pre>
<h4 id="t474.1.3 rollup.config.js">4.1.3 rollup.config.js <a href=#t474.1.3%20rollup.config.js class=sf-hidden> # </a></h4>
<p>rollup.config.js</p>
<pre><code class=lang-diff><span class=hljs-addition>+//import babel from '@rollup/plugin-babel'</span>
<span class=hljs-addition>+import babel from './plugins/rollup-plugin-babel'</span>
export default {
  input: "./src/index.js",
  output: [{
    dir: 'dist',
  }],
  plugins: [
<span class=hljs-addition>+   babel()</span>
  ]
}
</code></pre>
<h3 id="t484.2 @rollup/plugin-commonjs">4.2 @rollup/plugin-commonjs <a href=#t484.2%20@rollup/plugin-commonjs class=sf-hidden> # </a></h3>
<h4 id="t493.2.1 安装">3.2.1 安装 <a href=#t493.2.1%20%E5%AE%89%E8%A3%85 class=sf-hidden> # </a></h4>
<pre><code class=lang-js>pnpm install  @rollup/plugin-commonjs   --D
</code></pre>
<h4 id="t504.2.2 src\index.js">4.2.2 src\index.js <a href=#t504.2.2%20src\index.js class=sf-hidden> # </a></h4>
<p>src\index.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> catValue <span class=hljs-keyword>from</span> <span class=hljs-string>'./cat.js'</span>;
<span class=hljs-built_in>console</span>.log(catValue);
</code></pre>
<h4 id="t514.2.3 src\cat.js">4.2.3 src\cat.js <a href=#t514.2.3%20src\cat.js class=sf-hidden> # </a></h4>
<p>src\cat.js</p>
<pre><code class=lang-js><span class=hljs-built_in>module</span>.exports = <span class=hljs-string>'catValue'</span>;
</code></pre>
<h4 id="t524.2.4 rollup-plugin-commonjs.js">4.2.4 rollup-plugin-commonjs.js <a href=#t524.2.4%20rollup-plugin-commonjs.js class=sf-hidden> # </a></h4>
<p>plugins\rollup-plugin-commonjs.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> { createFilter } <span class=hljs-keyword>from</span> <span class=hljs-string>'rollup-pluginutils'</span>
<span class=hljs-keyword>import</span> MagicString <span class=hljs-keyword>from</span> <span class=hljs-string>'magic-string'</span>;
<span class=hljs-keyword>import</span> { walk } <span class=hljs-keyword>from</span> <span class=hljs-string>'estree-walker'</span>;
<span class=hljs-keyword>import</span> path <span class=hljs-keyword>from</span> <span class=hljs-string>'path'</span>;
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params>pluginOptions = {}</span>) </span>{
  <span class=hljs-keyword>const</span> defaultExtensions = [<span class=hljs-string>'.js'</span>, <span class=hljs-string>'.jsx'</span>]
  <span class=hljs-keyword>const</span> { exclude, include, extensions = defaultExtensions } = pluginOptions;
  <span class=hljs-keyword>const</span> extensionRegExp = <span class=hljs-keyword>new</span> <span class=hljs-built_in>RegExp</span>(
    <span class=hljs-string>`(<span class=hljs-subst>${extensions.join(<span class=hljs-string>'|'</span>)}</span>)$`</span>
  )
  <span class=hljs-keyword>const</span> userDefinedFilter = createFilter(include, exclude);
  <span class=hljs-keyword>const</span> filter = <span class=hljs-function><span class=hljs-params>id</span> =&gt;</span> extensionRegExp.test(id) &amp;&amp; userDefinedFilter(id);
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'commonjs'</span>,
    transform(code, id) {
      <span class=hljs-keyword>if</span> (!filter(id)) <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
      <span class=hljs-keyword>const</span> result = transformAndCheckExports(<span class=hljs-keyword>this</span>.parse, code, id)
      <span class=hljs-keyword>return</span> result;
    }
  }
}
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>transformAndCheckExports</span>(<span class=hljs-params>parse, code, id</span>) </span>{
  <span class=hljs-keyword>const</span> { isEsModule, ast } = analyzeTopLevelStatements(parse, code, id);
  <span class=hljs-keyword>if</span> (isEsModule) {
    <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
  }
  <span class=hljs-keyword>return</span> transformCommonjs(code, id, ast)
}
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>getKeypath</span>(<span class=hljs-params>node</span>) </span>{
  <span class=hljs-keyword>const</span> parts = [];
  <span class=hljs-keyword>while</span> (node.type === <span class=hljs-string>'MemberExpression'</span>) {
    parts.unshift(node.property.name);
    node = node.object;
  }
  <span class=hljs-keyword>if</span> (node.type !== <span class=hljs-string>'Identifier'</span>) <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
  <span class=hljs-keyword>const</span> { name } = node;
  parts.unshift(name);
  <span class=hljs-keyword>return</span> { name, <span class=hljs-attr>keypath</span>: parts.join(<span class=hljs-string>'.'</span>) };
}
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>analyzeTopLevelStatements</span>(<span class=hljs-params>parse, code</span>) </span>{
  <span class=hljs-keyword>const</span> ast = parse(code);
  <span class=hljs-keyword>let</span> isEsModule = <span class=hljs-literal>false</span>;
  <span class=hljs-keyword>for</span> (<span class=hljs-keyword>const</span> node <span class=hljs-keyword>of</span> ast.body) {
    <span class=hljs-keyword>switch</span> (node.type) {
      <span class=hljs-keyword>case</span> <span class=hljs-string>'ExportDefaultDeclaration'</span>:
        isEsModule = <span class=hljs-literal>true</span>;
        <span class=hljs-keyword>break</span>;
      <span class=hljs-keyword>case</span> <span class=hljs-string>'ExportNamedDeclaration'</span>:
        isEsModule = <span class=hljs-literal>true</span>;
        <span class=hljs-keyword>break</span>;
      <span class=hljs-keyword>case</span> <span class=hljs-string>'ImportDeclaration'</span>:
        isEsModule = <span class=hljs-literal>true</span>;
        <span class=hljs-keyword>break</span>;
      <span class=hljs-keyword>default</span>:
    }
  }
  <span class=hljs-keyword>return</span> { isEsModule, ast };
}
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>transformCommonjs</span>(<span class=hljs-params>code, id, ast</span>) </span>{
  <span class=hljs-keyword>const</span> magicString = <span class=hljs-keyword>new</span> MagicString(code);
  <span class=hljs-keyword>const</span> exportDeclarations = [];
  <span class=hljs-keyword>let</span> moduleExportsAssignment;
  walk(ast, {
    enter(node) {
      <span class=hljs-keyword>switch</span> (node.type) {
        <span class=hljs-keyword>case</span> <span class=hljs-string>'AssignmentExpression'</span>:
          <span class=hljs-keyword>if</span> (node.left.type === <span class=hljs-string>'MemberExpression'</span>) {
            <span class=hljs-keyword>const</span> flattened = getKeypath(node.left);
            <span class=hljs-keyword>if</span> (flattened.keypath === <span class=hljs-string>'module.exports'</span>) {
              moduleExportsAssignment = node;
            }
          }
          <span class=hljs-keyword>break</span>;
        <span class=hljs-keyword>default</span>:
          <span class=hljs-keyword>break</span>;
      }
    }
  });
  <span class=hljs-keyword>const</span> { left } = moduleExportsAssignment;
  <span class=hljs-keyword>const</span> exportsName = path.basename(id, path.extname(id));
  magicString.overwrite(left.start, left.end, exportsName);
  magicString.prependRight(left.start, <span class=hljs-string>'var '</span>);
  exportDeclarations.push(<span class=hljs-string>`export default <span class=hljs-subst>${exportsName}</span>;`</span>);
  <span class=hljs-keyword>const</span> exportBlock = <span class=hljs-string>`\n\n<span class=hljs-subst>${exportDeclarations.join(<span class=hljs-string>'\n'</span>)}</span>`</span>;
  magicString.trim().append(exportBlock);
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>code</span>: magicString.toString()
  }
}
</code></pre>
<h4 id="t534.2.5 rollup.config.js">4.2.5 rollup.config.js <a href=#t534.2.5%20rollup.config.js class=sf-hidden> # </a></h4>
<p>rollup.config.js</p>
<pre><code class=lang-diff>//import babel from '@rollup/plugin-babel'
//import babel from './plugins/rollup-plugin-babel.js'
//import commonjs from '@rollup/plugin-commonjs'
<span class=hljs-addition>+import commonjs from './plugins/rollup-plugin-commonjs'</span>
export default {
  input: "./src/index.js",
  output: {
    dir: 'dist'
  },
  plugins: [
    //babel(),
<span class=hljs-addition>+   commonjs()</span>
  ]
}
</code></pre>
<h3 id="t544.3 @rollup/plugin-node-resolve">4.3 @rollup/plugin-node-resolve <a href=#t544.3%20@rollup/plugin-node-resolve class=sf-hidden> # </a></h3>
<h4 id="t554.3.1 安装">4.3.1 安装 <a href=#t554.3.1%20%E5%AE%89%E8%A3%85 class=sf-hidden> # </a></h4>
<pre><code class=lang-js>pnpm install @rollup/plugin-node-resolve check-is-array -D
</code></pre>
<pre><code class=lang-js>(!) Unresolved dependencies
<span class=hljs-attr>https</span>:<span class=hljs-comment>//rollupjs.org/guide/en/#warning-treating-module-as-external-dependency</span>
isarray (imported by src/index.js)
</code></pre>
<h4 id="t564.3.2 src\index.js">4.3.2 src\index.js <a href=#t564.3.2%20src\index.js class=sf-hidden> # </a></h4>
<p>src\index.js</p>
<pre><code class=lang-diff>import isArray from 'check-is-array';
console.log(isArray);
</code></pre>
<h4 id="t574.3.3 rollup-plugin-node-resolve.js">4.3.3 rollup-plugin-node-resolve.js <a href=#t574.3.3%20rollup-plugin-node-resolve.js class=sf-hidden> # </a></h4>
<p>plugins\rollup-plugin-node-resolve.js</p>
<pre><code class=lang-js><span class=hljs-keyword>import</span> path <span class=hljs-keyword>from</span> <span class=hljs-string>'path'</span>;
<span class=hljs-keyword>import</span> Module <span class=hljs-keyword>from</span> <span class=hljs-string>'module'</span>;
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>resolve</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>return</span> {
    <span class=hljs-attr>name</span>: <span class=hljs-string>'resolve'</span>,
    <span class=hljs-comment>//因为我们要改造根据模块的名称查找模所路径的逻辑</span>
    <span class=hljs-keyword>async</span> resolveId(importee, importer) {
      <span class=hljs-comment>//如果是相对路径，则走默认逻辑</span>
      <span class=hljs-keyword>if</span> (importee[<span class=hljs-number>0</span>] === <span class=hljs-string>'.'</span> || path.isAbsolute(importee)) {
        <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
      }
      <span class=hljs-keyword>let</span> location = Module.createRequire(path.dirname(importer)).resolve(importee);
      <span class=hljs-built_in>console</span>.log(location);
      <span class=hljs-keyword>return</span> location;
    }
  }
}
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> resolve;
</code></pre>
<h3 id="t584.4 @rollup/plugin-alias">4.4 @rollup/plugin-alias <a href=#t584.4%20@rollup/plugin-alias class=sf-hidden> # </a></h3>
<h4 id="t594.4.1 rollup.config.js">4.4.1 rollup.config.js <a href=#t594.4.1%20rollup.config.js class=sf-hidden> # </a></h4>
<p>rollup.config.js</p>
<pre><code class=lang-js><span class=hljs-comment>//import build from './plugins/rollup-plugin-build.js';</span>
<span class=hljs-comment>//import polyfill from './plugins/rollup-plugin-inject-polyfill.js';</span>
<span class=hljs-comment>//import babel from './plugins/rollup-plugin-babel.js';</span>
<span class=hljs-comment>//import generation from './plugins/rollup-plugin-generation.js';</span>
<span class=hljs-comment>//import importPolyFill from './plugins/rollup-plugin-import-polyfill.js';</span>
<span class=hljs-comment>//import commonjs from '@rollup/plugin-commonjs';</span>
<span class=hljs-comment>//import commonjs from './plugins/rollup-plugin-commonjs';</span>
<span class=hljs-comment>//import resolve from '@rollup/plugin-node-resolve';</span>
<span class=hljs-keyword>import</span> resolve <span class=hljs-keyword>from</span> <span class=hljs-string>'./plugins/rollup-plugin-node-resolve.js'</span>;
<span class=hljs-comment>//import alias from '@rollup/plugin-alias';</span>
<span class=hljs-keyword>import</span> alias <span class=hljs-keyword>from</span> <span class=hljs-string>'./plugins/rollup-plugin-alias.js'</span>;

<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> {
  <span class=hljs-attr>input</span>: <span class=hljs-string>'./src/index.js'</span>,
  <span class=hljs-comment>//watch: true,</span>
  <span class=hljs-attr>output</span>: {
    <span class=hljs-comment>//file: 'dist/main.js',</span>
    <span class=hljs-attr>dir</span>: <span class=hljs-string>'dist'</span>
  },
  <span class=hljs-attr>plugins</span>: [
    resolve(),
    alias({
      <span class=hljs-attr>entries</span>: [
        { <span class=hljs-attr>find</span>: <span class=hljs-string>'./xx.js'</span>, <span class=hljs-attr>replacement</span>: <span class=hljs-string>'check-is-array'</span> }
      ]
    }),
  ],
  <span class=hljs-attr>watch</span>: {
    <span class=hljs-attr>clearScreen</span>: <span class=hljs-literal>false</span>
  }
}
</code></pre>
<h4 id="t604.4.2 rollup-plugin-alias.js">4.4.2 rollup-plugin-alias.js <a href=#t604.4.2%20rollup-plugin-alias.js class=sf-hidden> # </a></h4>
<p>plugins\rollup-plugin-alias.js</p>
<pre><code class=lang-js><span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>matches</span>(<span class=hljs-params>pattern, importee</span>) </span>{
    <span class=hljs-keyword>if</span> (pattern <span class=hljs-keyword>instanceof</span> <span class=hljs-built_in>RegExp</span>) {
        <span class=hljs-keyword>return</span> pattern.test(importee);
    }
    <span class=hljs-keyword>if</span> (importee.length &lt; pattern.length) {
        <span class=hljs-keyword>return</span> <span class=hljs-literal>false</span>;
    }
    <span class=hljs-keyword>if</span> (importee === pattern) {
        <span class=hljs-keyword>return</span> <span class=hljs-literal>true</span>;
    }
    <span class=hljs-keyword>return</span> importee.startsWith(pattern + <span class=hljs-string>'/'</span>);
}

<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>alias</span>(<span class=hljs-params>options = {}</span>) </span>{
    <span class=hljs-keyword>const</span> { entries } = options;
    <span class=hljs-keyword>if</span> (entries.length === <span class=hljs-number>0</span>) {
        <span class=hljs-keyword>return</span> {
            <span class=hljs-attr>name</span>: <span class=hljs-string>'alias'</span>,
            <span class=hljs-attr>resolveId</span>: <span class=hljs-function><span class=hljs-params>()</span> =&gt;</span> <span class=hljs-literal>null</span>
        };
    }
    <span class=hljs-keyword>return</span> {
        <span class=hljs-attr>name</span>: <span class=hljs-string>'alias'</span>,
        resolveId(importee, importer) {
            <span class=hljs-keyword>if</span> (!importer) {
                <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
            }
            <span class=hljs-keyword>const</span> matchedEntry = entries.find(<span class=hljs-function>(<span class=hljs-params>entry</span>) =&gt;</span> matches(entry.find, importee));
            <span class=hljs-keyword>if</span> (!matchedEntry) {
                <span class=hljs-keyword>return</span> <span class=hljs-literal>null</span>;
            }
            <span class=hljs-keyword>const</span> updatedId = importee.replace(matchedEntry.find, matchedEntry.replacement);
            <span class=hljs-comment>//调用this.resolve意味着重新解析</span>
            <span class=hljs-keyword>return</span> <span class=hljs-keyword>this</span>.resolve(updatedId, importer, <span class=hljs-built_in>Object</span>.assign({ <span class=hljs-attr>skipSelf</span>: <span class=hljs-literal>true</span> }))
                .then(<span class=hljs-function>(<span class=hljs-params>resolved</span>) =&gt;</span> resolved || { <span class=hljs-attr>id</span>: updatedId });
        }
    };
}
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> alias;
</code></pre>
 </div>
</div>
