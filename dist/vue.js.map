{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组中的部分方法\r\nlet oldArrayProto = Array.prototype\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto)\r\n\r\n\r\n// 数组的变异方法\r\nlet methods = [\r\n  'pop',\r\n  'push',\r\n  'shift',\r\n  'unshift',\r\n  'splice',\r\n  'reverse',\r\n  'sort'\r\n] //concat 和 slice 不会改变数组\r\n\r\nmethods.forEach(method => {\r\n  newArrayProto[method] = function(...args) {\r\n    debugger;\r\n    // 内部调用原来的方法, 函数的劫持,切片编程\r\n    const result = oldArrayProto[method].call(this, ...args)\r\n\r\n    // 对新增的数据再次劫持\r\n    let inserted\r\n\r\n    let ob = this.__ob__\r\n    switch(method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n      default:\r\n        break\r\n    }\r\n    if (inserted) {\r\n      ob.observeArray(inserted)\r\n    }\r\n    return result\r\n  }\r\n})","import { newArrayProto } from \"./array\"\r\n\r\nclass Observer {\r\n  constructor(data) {\r\n    // __ob__ 这个属性是做什么的呢？\r\n    // Object.defineProperty只能劫持已经存在的属性(vue里面会为此单独写一些api $set $delete)\r\n    // !!!! 为什么给data赋值ob的属性，因为想要在重写数组的方法里面能够取到this\r\n    Object.defineProperty(data, '__ob__', {\r\n      value: this,\r\n      enumerable: false // 将__ob__变成不可枚举的(循环的时候无法获取到)\r\n    })\r\n    debugger\r\n    if (Array.isArray(data)) {\r\n      debugger\r\n      data.__proto__ = newArrayProto\r\n      this.observeArray(data)\r\n    } else {\r\n      this.walk(data)\r\n    }\r\n  }\r\n  walk(data) { // 循环对象 对对象属性一次劫持\r\n    // \"重新定义\"属性 性能差\r\n    Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\r\n  }\r\n  observeArray(data) {\r\n    data.forEach(item => observe(item))\r\n  }\r\n}\r\n\r\n\r\nexport function defineReactive(target, key, value) {\r\n  observe(value)\r\n  Object.defineProperty(target, key, {\r\n    get() {\r\n      console.log('get', key, value)\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      console.log('set', key)\r\n      if (newValue === value) return \r\n      observe(newValue) // 如果设置的值是一个对象，再次对数据进行劫持\r\n      value = newValue\r\n    }\r\n  }) \r\n}\r\n\r\nexport function observe(data) {\r\n  if (typeof data !== 'object' || data == null) {\r\n    return\r\n  }\r\n  if (data.__ob__ instanceof Observer) { // 已经被劫持过了，不需要被再次劫持\r\n    return data.__ob__\r\n  }\r\n  return new Observer(data)\r\n}","import { observe } from \"./observe\"\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options // 获取所有选项\r\n\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n\r\nfunction proxy(vm, target, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[target][key]\r\n    },\r\n    set(newValue) {\r\n      vm[target][key] = newValue\r\n    }\r\n  })\r\n}\r\n\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data // data可能是函数或者对象\r\n  data = typeof data === 'function' ? data.call(vm) : data\r\n\r\n  vm._data = data\r\n  observe(data) // 对data进行数据劫持\r\n\r\n  // 如果想要直接通过this.xxx访问属性。使用vm来进行代理\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n}","import { initState } from \"./state\"\r\n\r\nexport function initMixin(Vue) { // 就是为了给Vue增加init方法的\r\n  Vue.prototype._init = function(options) {\r\n    const vm = this\r\n    vm.$options = options\r\n\r\n    initState(vm)\r\n  }\r\n\r\n}","import { initMixin } from \"./init\"\r\n\r\nfunction Vue(options) { // options就是用户的选项\r\n  this._init(options) // 默认就调用init\r\n}\r\n\r\ninitMixin(Vue) // 扩展了init方法\r\n\r\n\r\nexport default Vue"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","observeArray","Observer","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","console","log","set","newValue","initState","vm","opts","$options","initData","proxy","_data","initMixin","Vue","_init","options"],"mappings":"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"}